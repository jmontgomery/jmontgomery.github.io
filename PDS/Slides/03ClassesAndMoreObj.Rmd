---
title: "Classes and more structures"
author: |
  | Jacob M. Montgomery
  | *Washington University in St. Louis*
  | *Department of Politcal Science*
date: '2020'
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      countIncrementalSlides: false
#   beamer_presentation: default
#   slidy_presentation: default


---

## Orientation for today

Last time: 

1. Introduction to objects
2. Special focus on vectors


<br>
<br>


--

We are going to:

1. Talk about object classes
    + Character class
    + Logical class

2. More data structures
    + Building block classes
    + Matrix
    + Lists
    + Dataframes

---

## Let's read these in again to get ourselves started

```{r}
vap<-voting.age.population<-c(3481823, 496387, 4582842, 2120139,26955438,
                              3617942,2673154,652189,472143,14085749,6915512,
                              995937,1073799,9600372,4732010,2265860,2068253,
                              3213141,3188765,1033632,4242214,4997677,7620982,
                              3908159,2139918,4426278,731365,1321923,1870315,1012033,
                              6598368,1452962,14838076,6752018,494923,8697456,2697855,
                              2850525,9612380,824854,3303593,594599,4636679,
                              17038979,1797941,487900,5841335,4876661,1421717,
                              4257230,392344)    


total.votes<-tv<-c(NA, 238307, 1553032, 780409,8899059,1586105, 
                   1162391,258053, 122356,4884544, 2143845,348988, 
                   458927,3586292, 1719351,1071509, 864083,1370062, 
                   954896,NA, 1809237, 2243835,3852008, 2217552,NA, 
                   2178278, 411061,610499, 586274,418550, 2315643,568597, 
                   4703830,2036451, 220479,4184072, NA,1399650, NA,392882, 
                   1117311,341105, 1868363,NA, 582561, 263025,2398589, 
                   2085074,473014, 2183155, 196217)
```


---

## 3.1 Object Classes 

We have already come across two types or "classes" of objects in R.



```{r}
class(log) # functions
class(total.votes) # numeric
``` 


---


There are lot's of "types" of objects.  

- Classes just indicate the properties of an object
- Tell R how to store the data

--

- Some functions have different "instructions" when you use them with objects of different classes.

```{r}
mean(vap) ## this is fine
mean(c("Four score and seven years ago...",
       "... our four fathers...")) #nope
``` 

---

## 2.2: logical and character

- Typically objects have one class, but some will have multiple classes.
- Many packages include their own class definition.
- But there are ony a few core object classes.


--

The building blocks of R

- You have seen 'function' and 'numeric'. 
- 'logical' (sometimes referred to as a Boolean)

```{r}
class(TRUE)
```

--

- 'character' (sometimes referred to as a string)
```{r}
class("Sorry losers and haters")
```

---

## 2.3: Factors are evil but (sometimes) necessary


You will sometimes see factors, but they are the devil

```{r}
grp<- c("control", "treatment", "control", "treatment")
grp
grp<-factor(grp)
grp
class(grp) 
```

---

- Some functions require factors. 
- For some tasks they make things easier.  
- But if you can ... avoid.

--

```{r}
levels(grp)
c(grp)
```

--

- You can see that the "control" level is equivalent to 1 and the "treatment" group is set to 2.
- But you can't treat them as actual numbers.

```{r}
mean(grp)
```

- Beware that not all functions bother to check for this.


---


## 2.4 Functions for classes


There are functions to move back and forth between types
- There are a lot of 'as.class' functions


```{r}
as.integer(grp) 
```

--

- You can also check if an object is a specific class.

```{r}
is.integer(vap) 
is.numeric(vap)
```

---

There are several types of these

```{r}
as.character(0:5) # Turning numbers into characters
as.complex(0:5) # Imaginary numbes
as.logical(0:5) # All numbers but '0' become FALSE
```

---

But not all of them work
```{r}
as.numeric(c('1', '2', '3')) 
as.numeric(c('a', 'b', 'c')) 
```


---

## 2.5: Vectors can only be of one type

Numbers get changed to strings
```{r}
xx<-c(0, 2, "Monkey", 5) 
xx
class(xx)
```

--

Logicals get recast as numerics
```{r}
xx<-c(TRUE, FALSE,0, TRUE) # 
xx
class(xx)
```


---


## 2.6: Special character functions

- Some functions can only be used on specific data types. 
- This will be listed in the help files.


Let's make a couple of examples:
```{r}
colors<-c("red", "yellow", "blue") 
# Remember: what happens if we don't use quotes?
```

--

```{r}
more.colors <- c(colors, "green", "magenta", "cyan")
```


---

## 2.6.1: Substring

You might want only a portion of the string. 

```{r}
substr(colors, start=1, stop=2)
```

For each string show the part of the string in the start position to the stop position.


--
<br>
<br>

Remember you don't have to use the options if you know the order of the arguments

```{r}
substr(colors, 1,2) 
# ?substr
```

---

## 2.6.2: paste

You might want to combine strings



```{r}
paste0(colors, "flowers") # combine two strings
paste(colors, "flowers", sep="") # combine two strings
```


---



```{r}
paste("I like", colors, "flowers")
```

--

You can use "" for an empty string.  Like NA for numeric

```{r}
paste("I like", colors, "flowers", collapse = "")
```

---

## 2.6.2: nchar

You can also count how many characters are in each string

```{r}
nchar(colors) 
```

---

## 2.6.3: strsplit


You may want to divide a string into components
```{r}
extreme.statement<-"Coding is my life"
this.out<-strsplit(extreme.statement, split=" ")  
```

--

Now let's seperate them into elements (the output of 'strsplit' is a list ... more on that soon)

```{r}
unlist(this.out)
```

---

## 2.6.4: gsub

- 'gsub' is not particular to strings, but very useful.
- I use it to replace elments 

```{r}
gsub("my life", "the bee's knees", extreme.statement) 
# less extreme.  More true
```


--

What does this do?

```{r}
gsub(" is my life", "", extreme.statement)
```

---

## String tips


- If you are doing a lot with strings try the library 'strgr', which has some user-friendly functions
- If you include '\n' in a string, in many instances it will be a carriage return (e.g., plotting)
- A very common programming error (at least for me) is to forget a closing quotation mark.  
- This will make the computer think you are still making a giantly long string.

---


## 2.3 More on Boolean Logic
## use logicals to subset, recode, or otherwise handle data

x
chooser<-c(T, F, T)
x[chooser] # print ony those elements of x where chooser is TRUE
sum(chooser) # Arithmatic on logicals creates numerics
!chooser # not operator


## We can generate logical vectors using basic boolean algebra
x == 7
x >7
x>=7
x<7
x!=7
x<=7
x<7 | x ==7 ## the or operator
x<=7 & x == 7 ## the and operator
x<=7 || x==7 ## these are NOT the same 
x<=7 && x==7 ## not what you think


# #There are also some function that create logicals.
is.na(total.votes) # vectorized
total.votes
is.numeric(total.votes) # this is not vectorized

## You can use these to do fun things to data

## subset
small.states<- voting.age.population[voting.age.population < median(voting.age.population)]
small.states

## recode
state.size<-(voting.age.population > median(voting.age.population)) *1
state.size

## or this
state.size[state.size == 1] <- rep(3, sum(state.size == 1))
state.size

## or this
state.size[state.size == 3] <- 5
state.size
## or this
state.size[state.size > 0] <- 1
state.size

## Another useful function is which().  Provides the index of elements where the condition is true
which(state.size == 1)

x
any(x>2) # are any elements TRUE?
all(x>2) # are all elements TRUE?


##Tip: Be *VERY* careful about combining & with | -- especially in the presence of !

(2==3 & 2==2 | 2==2)
(2==3 & 2==2 | 2==2 & 2==3)
(2==3 | !2==2 & 2==2 | 2==5)
(2==3 | !2==3 & 2==2 | 2==5)
(2==3 | !2==3 & 2==2 | 2==5)
(2==3 | !(2==3 & 2==2) | 2==5)
