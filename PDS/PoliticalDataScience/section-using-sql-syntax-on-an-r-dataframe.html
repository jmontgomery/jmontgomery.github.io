<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Using SQL syntax on an R dataframe | Political Data Science</title>
  <meta name="description" content="10 Using SQL syntax on an R dataframe | Political Data Science" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Using SQL syntax on an R dataframe | Political Data Science" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Using SQL syntax on an R dataframe | Political Data Science" />
  
  
  

<meta name="author" content="Jacob Montgomery and Mariah Yelenick" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="section-functions-and-packages.html"/>
<link rel="next" href="section-machine-learning.html"/>
<script src="libs/header-attrs-2.1/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Don’t be a clown</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#section-as-easy-as-cake"><i class="fa fa-check"></i><b>1.1</b> As easy as cake</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#section-coding"><i class="fa fa-check"></i><b>1.1.1</b> Coding</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#section-data-acquision"><i class="fa fa-check"></i><b>1.1.2</b> Data acquision</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="index.html#section-algorithms"><i class="fa fa-check"></i><b>1.1.3</b> Algorithms</a></li>
<li class="chapter" data-level="1.1.4" data-path="index.html"><a href="index.html#section-domain-knowledge"><i class="fa fa-check"></i><b>1.1.4</b> Domain knowledge</a></li>
<li class="chapter" data-level="1.1.5" data-path="index.html"><a href="index.html#section-putting-it-together"><i class="fa fa-check"></i><b>1.1.5</b> Putting it together</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#section-class-structures"><i class="fa fa-check"></i><b>1.2</b> Class structures</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#section-learning-objective-1-team-based-learning"><i class="fa fa-check"></i><b>1.2.1</b> Learning objective #1: Team based learning</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#section-learning-objective-2-show-up-ready"><i class="fa fa-check"></i><b>1.2.2</b> Learning objective #2: Show up ready</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#section-learning-objective-3-how-is-this-going-to-work"><i class="fa fa-check"></i><b>1.2.3</b> Learning objective #3: How is this going to work?</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#section-interactive-r-environment"><i class="fa fa-check"></i><b>1.3</b> Interactive R Environment</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="section-getting-started-in-r.html"><a href="section-getting-started-in-r.html"><i class="fa fa-check"></i><b>2</b> Getting Started in R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="section-getting-started-in-r.html"><a href="section-getting-started-in-r.html#section-learning-objectives"><i class="fa fa-check"></i><b>2.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="2.2" data-path="section-getting-started-in-r.html"><a href="section-getting-started-in-r.html#section-assigning-values-to-objects"><i class="fa fa-check"></i><b>2.2</b> Assigning values to objects</a></li>
<li class="chapter" data-level="2.3" data-path="section-getting-started-in-r.html"><a href="section-getting-started-in-r.html#section-r-as-a-calculator"><i class="fa fa-check"></i><b>2.3</b> R as a calculator</a></li>
<li class="chapter" data-level="2.4" data-path="section-getting-started-in-r.html"><a href="section-getting-started-in-r.html#section-the-global-environment-and-how-to-clean-it"><i class="fa fa-check"></i><b>2.4</b> The global environment and how to clean it</a></li>
<li class="chapter" data-level="2.5" data-path="section-getting-started-in-r.html"><a href="section-getting-started-in-r.html#section-getting-help"><i class="fa fa-check"></i><b>2.5</b> Getting help</a></li>
<li class="chapter" data-level="2.6" data-path="section-getting-started-in-r.html"><a href="section-getting-started-in-r.html#section-installing-packages"><i class="fa fa-check"></i><b>2.6</b> Installing packages</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html"><i class="fa fa-check"></i><b>3</b> Data Types in R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-functions"><i class="fa fa-check"></i><b>3.1</b> Functions</a></li>
<li class="chapter" data-level="3.2" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-vectors"><i class="fa fa-check"></i><b>3.2</b> Vectors</a></li>
<li class="chapter" data-level="3.3" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-functions-and-vectors"><i class="fa fa-check"></i><b>3.3</b> Functions and vectors</a></li>
<li class="chapter" data-level="3.4" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-logicalsbooleans"><i class="fa fa-check"></i><b>3.4</b> Logicals/Booleans</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-boolean-logic"><i class="fa fa-check"></i><b>3.4.1</b> Boolean logic</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-charactersstrings"><i class="fa fa-check"></i><b>3.5</b> Characters/Strings</a></li>
<li class="chapter" data-level="3.6" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-matrices"><i class="fa fa-check"></i><b>3.6</b> Matrices</a></li>
<li class="chapter" data-level="3.7" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-matrix-algebra-optional"><i class="fa fa-check"></i><b>3.7</b> Matrix algebra (optional)</a></li>
<li class="chapter" data-level="3.8" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-lists"><i class="fa fa-check"></i><b>3.8</b> Lists</a></li>
<li class="chapter" data-level="3.9" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-arrays"><i class="fa fa-check"></i><b>3.9</b> Arrays</a></li>
<li class="chapter" data-level="3.10" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-dataframes"><i class="fa fa-check"></i><b>3.10</b> Dataframes</a></li>
<li class="chapter" data-level="3.11" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-general-info"><i class="fa fa-check"></i><b>3.11</b> General info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html"><i class="fa fa-check"></i><b>4</b> Files, For Loops, and Functions</a>
<ul>
<li class="chapter" data-level="4.1" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-the-working-directory"><i class="fa fa-check"></i><b>4.1</b> The working directory</a></li>
<li class="chapter" data-level="4.2" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-input-and-output"><i class="fa fa-check"></i><b>4.2</b> Input and output</a></li>
<li class="chapter" data-level="4.3" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-if-else-ifelse"><i class="fa fa-check"></i><b>4.3</b> if, else, ifelse</a></li>
<li class="chapter" data-level="4.4" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-repeat-and-while"><i class="fa fa-check"></i><b>4.4</b> repeat and while</a></li>
<li class="chapter" data-level="4.5" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-for-loops"><i class="fa fa-check"></i><b>4.5</b> for loops</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-next-and-break"><i class="fa fa-check"></i><b>4.5.1</b> next and break</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-functions-1"><i class="fa fa-check"></i><b>4.6</b> Functions</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-the-basics"><i class="fa fa-check"></i><b>4.6.1</b> The basics</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-setting-defaults"><i class="fa fa-check"></i><b>4.7</b> Setting defaults</a></li>
<li class="chapter" data-level="4.8" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-scope"><i class="fa fa-check"></i><b>4.8</b> Scope</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-advanced-scope-topics"><i class="fa fa-check"></i><b>4.8.1</b> Advanced scope topics</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-debugging"><i class="fa fa-check"></i><b>4.9</b> Debugging</a></li>
<li class="chapter" data-level="4.10" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-benchmarking-and-code-improvements"><i class="fa fa-check"></i><b>4.10</b> Benchmarking and code improvements</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-vectorizing"><i class="fa fa-check"></i><b>4.10.1</b> Vectorizing</a></li>
<li class="chapter" data-level="4.10.2" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-pastecollapse-and-copies"><i class="fa fa-check"></i><b>4.10.2</b> Paste/collapse and copies</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-version-control.html"><a href="section-version-control.html"><i class="fa fa-check"></i><b>5</b> Version Control</a>
<ul>
<li class="chapter" data-level="5.1" data-path="section-version-control.html"><a href="section-version-control.html#section-why-version-control"><i class="fa fa-check"></i><b>5.1</b> Why version control?</a></li>
<li class="chapter" data-level="5.2" data-path="section-version-control.html"><a href="section-version-control.html#section-setup"><i class="fa fa-check"></i><b>5.2</b> Setup</a></li>
<li class="chapter" data-level="5.3" data-path="section-version-control.html"><a href="section-version-control.html#section-workflow"><i class="fa fa-check"></i><b>5.3</b> Workflow</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="section-version-control.html"><a href="section-version-control.html#section-pull"><i class="fa fa-check"></i><b>5.3.1</b> Pull</a></li>
<li class="chapter" data-level="5.3.2" data-path="section-version-control.html"><a href="section-version-control.html#section-commit"><i class="fa fa-check"></i><b>5.3.2</b> Commit</a></li>
<li class="chapter" data-level="5.3.3" data-path="section-version-control.html"><a href="section-version-control.html#section-push"><i class="fa fa-check"></i><b>5.3.3</b> Push</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="section-version-control.html"><a href="section-version-control.html#section-branches"><i class="fa fa-check"></i><b>5.4</b> Branches</a></li>
<li class="chapter" data-level="5.5" data-path="section-version-control.html"><a href="section-version-control.html#section-forking"><i class="fa fa-check"></i><b>5.5</b> Forking</a></li>
<li class="chapter" data-level="5.6" data-path="section-version-control.html"><a href="section-version-control.html#section-reverting"><i class="fa fa-check"></i><b>5.6</b> Reverting</a></li>
<li class="chapter" data-level="5.7" data-path="section-version-control.html"><a href="section-version-control.html#section-conflict-management"><i class="fa fa-check"></i><b>5.7</b> Conflict management</a></li>
<li class="chapter" data-level="5.8" data-path="section-version-control.html"><a href="section-version-control.html#section-version-control-in-rstudio"><i class="fa fa-check"></i><b>5.8</b> Version Control in RStudio</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="section-data-visualization-in-r.html"><a href="section-data-visualization-in-r.html"><i class="fa fa-check"></i><b>6</b> Data Visualization in R</a>
<ul>
<li class="chapter" data-level="6.1" data-path="section-data-visualization-in-r.html"><a href="section-data-visualization-in-r.html#section-intro-to-ggplot2"><i class="fa fa-check"></i><b>6.1</b> Intro to ggplot2</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="section-data-visualization-in-r.html"><a href="section-data-visualization-in-r.html#section-example"><i class="fa fa-check"></i><b>6.1.1</b> Example</a></li>
<li class="chapter" data-level="6.1.2" data-path="section-data-visualization-in-r.html"><a href="section-data-visualization-in-r.html#section-aesthetics"><i class="fa fa-check"></i><b>6.1.2</b> Aesthetics</a></li>
<li class="chapter" data-level="6.1.3" data-path="section-data-visualization-in-r.html"><a href="section-data-visualization-in-r.html#section-facets"><i class="fa fa-check"></i><b>6.1.3</b> Facets</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="section-data-visualization-in-r.html"><a href="section-data-visualization-in-r.html#section-more-geom-options"><i class="fa fa-check"></i><b>6.2</b> More <code>geom</code> options</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html"><i class="fa fa-check"></i><b>7</b> dplyr and tidy</a>
<ul>
<li class="chapter" data-level="7.1" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-into-the-tidyverse"><i class="fa fa-check"></i><b>7.1</b> Into the tidyverse</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-our-example"><i class="fa fa-check"></i><b>7.1.1</b> Our example</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-back-to-dplyr"><i class="fa fa-check"></i><b>7.2</b> Back to <code>dplyr</code></a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-filter"><i class="fa fa-check"></i><b>7.2.1</b> <code>filter</code></a></li>
<li class="chapter" data-level="7.2.2" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-arrange"><i class="fa fa-check"></i><b>7.2.2</b> <code>arrange</code></a></li>
<li class="chapter" data-level="7.2.3" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-select"><i class="fa fa-check"></i><b>7.2.3</b> <code>select</code></a></li>
<li class="chapter" data-level="7.2.4" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-mutate"><i class="fa fa-check"></i><b>7.2.4</b> <code>mutate</code></a></li>
<li class="chapter" data-level="7.2.5" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-summarise"><i class="fa fa-check"></i><b>7.2.5</b> <code>summarise</code></a></li>
<li class="chapter" data-level="7.2.6" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-piping"><i class="fa fa-check"></i><b>7.2.6</b> Piping</a></li>
<li class="chapter" data-level="7.2.7" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-pivots"><i class="fa fa-check"></i><b>7.2.7</b> Pivots</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-relational-data"><i class="fa fa-check"></i><b>7.3</b> Relational data</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-mutating-join"><i class="fa fa-check"></i><b>7.3.1</b> Mutating join</a></li>
<li class="chapter" data-level="7.3.2" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-joins-topography"><i class="fa fa-check"></i><b>7.3.2</b> Joins topography</a></li>
<li class="chapter" data-level="7.3.3" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-many-and-one-to-many"><i class="fa fa-check"></i><b>7.3.3</b> Many and one-to-many</a></li>
<li class="chapter" data-level="7.3.4" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-filtering-joins"><i class="fa fa-check"></i><b>7.3.4</b> Filtering joins</a></li>
<li class="chapter" data-level="7.3.5" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-set-operations"><i class="fa fa-check"></i><b>7.3.5</b> Set operations</a></li>
<li class="chapter" data-level="7.3.6" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-exercise"><i class="fa fa-check"></i><b>7.3.6</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-stringr"><i class="fa fa-check"></i><b>7.4</b> <code>stringr</code></a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-things-you-havent-thought-about-strings"><i class="fa fa-check"></i><b>7.4.1</b> Things you haven’t thought about strings</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-pipes-and-maps"><i class="fa fa-check"></i><b>7.5</b> Pipes and maps</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-limitations-of-pipes"><i class="fa fa-check"></i><b>7.5.1</b> Limitations of Pipes</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-map"><i class="fa fa-check"></i><b>7.6</b> <code>map</code></a></li>
<li class="chapter" data-level="7.7" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-walk-purrr-and-more"><i class="fa fa-check"></i><b>7.7</b> walk, purrr, and more</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="section-more-useful-packages.html"><a href="section-more-useful-packages.html"><i class="fa fa-check"></i><b>8</b> More useful packages</a>
<ul>
<li class="chapter" data-level="8.1" data-path="section-more-useful-packages.html"><a href="section-more-useful-packages.html#section-stringr-1"><i class="fa fa-check"></i><b>8.1</b> <code>stringr</code></a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="section-more-useful-packages.html"><a href="section-more-useful-packages.html#section-things-you-havent-thought-about-strings-1"><i class="fa fa-check"></i><b>8.1.1</b> Things you haven’t thought about strings</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html"><i class="fa fa-check"></i><b>9</b> Functions and Packages</a>
<ul>
<li class="chapter" data-level="9.1" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-apply-and-its-friends"><i class="fa fa-check"></i><b>9.1</b> <code>apply</code> and its friends</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-apply"><i class="fa fa-check"></i><b>9.1.1</b> <code>apply</code></a></li>
<li class="chapter" data-level="9.1.2" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-lapply"><i class="fa fa-check"></i><b>9.1.2</b> <code>lapply</code></a></li>
<li class="chapter" data-level="9.1.3" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-sapply"><i class="fa fa-check"></i><b>9.1.3</b> <code>sapply</code></a></li>
<li class="chapter" data-level="9.1.4" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-tapply"><i class="fa fa-check"></i><b>9.1.4</b> <code>tapply</code></a></li>
<li class="chapter" data-level="9.1.5" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-sweep"><i class="fa fa-check"></i><b>9.1.5</b> <code>sweep</code></a></li>
<li class="chapter" data-level="9.1.6" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-by"><i class="fa fa-check"></i><b>9.1.6</b> <code>by</code></a></li>
<li class="chapter" data-level="9.1.7" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-vapply-and-more"><i class="fa fa-check"></i><b>9.1.7</b> <code>vapply</code> And more</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-plyr"><i class="fa fa-check"></i><b>9.2</b> <code>plyr</code></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html"><i class="fa fa-check"></i><b>10</b> Using SQL syntax on an R dataframe</a>
<ul>
<li class="chapter" data-level="10.1" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-sql"><i class="fa fa-check"></i><b>10.1</b> SQL</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-select-and-from"><i class="fa fa-check"></i><b>10.1.1</b> <code>SELECT</code> and <code>FROM</code></a></li>
<li class="chapter" data-level="10.1.2" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-where"><i class="fa fa-check"></i><b>10.1.2</b> <code>WHERE</code></a></li>
<li class="chapter" data-level="10.1.3" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-functions-2"><i class="fa fa-check"></i><b>10.1.3</b> Functions</a></li>
<li class="chapter" data-level="10.1.4" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-having"><i class="fa fa-check"></i><b>10.1.4</b> <code>HAVING</code></a></li>
<li class="chapter" data-level="10.1.5" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-withas-and-subqueries"><i class="fa fa-check"></i><b>10.1.5</b> <code>WITH</code>/<code>AS</code> and Subqueries</a></li>
<li class="chapter" data-level="10.1.6" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-joins"><i class="fa fa-check"></i><b>10.1.6</b> Joins</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-the-sqldf-package"><i class="fa fa-check"></i><b>10.2</b> The <code>sqldf</code> package</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="section-machine-learning.html"><a href="section-machine-learning.html"><i class="fa fa-check"></i><b>11</b> Machine Learning</a>
<ul>
<li class="chapter" data-level="11.1" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-supervised-learning"><i class="fa fa-check"></i><b>11.1</b> Supervised Learning</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-the-gist"><i class="fa fa-check"></i><b>11.1.1</b> The Gist</a></li>
<li class="chapter" data-level="11.1.2" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-what-could-go-wrong"><i class="fa fa-check"></i><b>11.1.2</b> What could go wrong?</a></li>
<li class="chapter" data-level="11.1.3" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-example-predicting-presidential-elections-with-vote-share"><i class="fa fa-check"></i><b>11.1.3</b> Example: Predicting presidential elections with vote share</a></li>
<li class="chapter" data-level="11.1.4" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-the-complexity-of-keeping-it-simple"><i class="fa fa-check"></i><b>11.1.4</b> The complexity of keeping it simple</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-classification"><i class="fa fa-check"></i><b>11.2</b> Classification</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-classification-basics-binary-outcomes"><i class="fa fa-check"></i><b>11.2.1</b> Classification basics: Binary outcomes</a></li>
<li class="chapter" data-level="11.2.2" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-the-linear-classifier-aka-logit"><i class="fa fa-check"></i><b>11.2.2</b> The linear classifier (AKA Logit)</a></li>
<li class="chapter" data-level="11.2.3" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-more-models"><i class="fa fa-check"></i><b>11.2.3</b> More models</a></li>
<li class="chapter" data-level="11.2.4" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-random-forests"><i class="fa fa-check"></i><b>11.2.4</b> Random forests</a></li>
<li class="chapter" data-level="11.2.5" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-k-nearest-neighbors"><i class="fa fa-check"></i><b>11.2.5</b> K Nearest Neighbors</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-putting-that-in-action"><i class="fa fa-check"></i><b>11.3</b> Putting that in action</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="section-causality.html"><a href="section-causality.html"><i class="fa fa-check"></i><b>12</b> Causality</a>
<ul>
<li class="chapter" data-level="12.1" data-path="section-causality.html"><a href="section-causality.html#section-correlation-and-causation"><i class="fa fa-check"></i><b>12.1</b> Correlation and causation</a></li>
<li class="chapter" data-level="12.2" data-path="section-causality.html"><a href="section-causality.html#section-a-formal-definition"><i class="fa fa-check"></i><b>12.2</b> A formal definition</a></li>
<li class="chapter" data-level="12.3" data-path="section-causality.html"><a href="section-causality.html#section-formal-presentation-of-an-ate"><i class="fa fa-check"></i><b>12.3</b> Formal presentation of an ATE</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="section-causality.html"><a href="section-causality.html#section-danger"><i class="fa fa-check"></i><b>12.3.1</b> Danger!</a></li>
<li class="chapter" data-level="12.3.2" data-path="section-causality.html"><a href="section-causality.html#section-does-drinking-make-you-more-educated"><i class="fa fa-check"></i><b>12.3.2</b> Does drinking make you more educated?</a></li>
<li class="chapter" data-level="12.3.3" data-path="section-causality.html"><a href="section-causality.html#section-problem-it-can-be-way-more-subtle"><i class="fa fa-check"></i><b>12.3.3</b> Problem: It can be way more subtle</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="section-causality.html"><a href="section-causality.html#section-estimating-ate"><i class="fa fa-check"></i><b>12.4</b> Estimating ATE</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="section-causality.html"><a href="section-causality.html#section-filling-in-the-potential-values"><i class="fa fa-check"></i><b>12.4.1</b> Filling in the potential values</a></li>
<li class="chapter" data-level="12.4.2" data-path="section-causality.html"><a href="section-causality.html#section-good-causal-inference"><i class="fa fa-check"></i><b>12.4.2</b> Good causal inference</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="section-causality.html"><a href="section-causality.html#section-experiments-ab-testing"><i class="fa fa-check"></i><b>12.5</b> Experiments: A/B Testing</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="section-causality.html"><a href="section-causality.html#section-what-to-do-when-you-cant-experiment"><i class="fa fa-check"></i><b>12.5.1</b> What to do when you can’t experiment:</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="section-causality.html"><a href="section-causality.html#section-panel-data-and-fixed-effects"><i class="fa fa-check"></i><b>12.6</b> Panel data and fixed effects</a>
<ul>
<li class="chapter" data-level="12.6.1" data-path="section-causality.html"><a href="section-causality.html#section-example-are-elections-fought-over-non-economic-issues-more-when-globalization-increases"><i class="fa fa-check"></i><b>12.6.1</b> Example: Are elections fought over non-economic issues more when globalization increases?</a></li>
<li class="chapter" data-level="12.6.2" data-path="section-causality.html"><a href="section-causality.html#section-naive-regression"><i class="fa fa-check"></i><b>12.6.2</b> Naive regression</a></li>
<li class="chapter" data-level="12.6.3" data-path="section-causality.html"><a href="section-causality.html#section-fixed-effects"><i class="fa fa-check"></i><b>12.6.3</b> Fixed effects</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="section-causality.html"><a href="section-causality.html#section-difference-in-differences"><i class="fa fa-check"></i><b>12.7</b> Difference-in-differences</a>
<ul>
<li class="chapter" data-level="12.7.1" data-path="section-causality.html"><a href="section-causality.html#section-did-in-practice"><i class="fa fa-check"></i><b>12.7.1</b> DID in practice</a></li>
<li class="chapter" data-level="12.7.2" data-path="section-causality.html"><a href="section-causality.html#section-regression-discontinuity"><i class="fa fa-check"></i><b>12.7.2</b> Regression discontinuity</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Political Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-using-sql-syntax-on-an-r-dataframe" class="section level1" number="10">
<h1><span class="header-section-number">10</span> Using SQL syntax on an R dataframe</h1>
<div id="section-sql" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> SQL</h2>
<p>SQL (Structured Query Language) is the universally most widely used querying language for databases. There are variations of SQL,
the most popular being MySQL and PostgreSQL. The syntax is very similar for all versions of SQL.</p>
<p><a href="https://www.sqltutorial.org/sql-syntax/">Here</a>’s a helpful tutorial for SQl commands, but a few basic examples of each keyword are shown below:</p>
<div id="section-select-and-from" class="section level3" number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> <code>SELECT</code> and <code>FROM</code></h3>
<pre><code>SELECT col1, col2, col3 FROM table1

SELECT * FROM table1</code></pre>
<p>The first example selects the three columns specified from a table called table1. It will select all rows from table1 and return them in a new, temporary table
unless the result is stored or used somewhere examples</p>
<p>The second example selects all columns (and rows) from table1.</p>
</div>
<div id="section-where" class="section level3" number="10.1.2">
<h3><span class="header-section-number">10.1.2</span> <code>WHERE</code></h3>
<pre><code>SELECT movie_title, user, rating 
    FROM movies 
    WHERE rating &gt; 4 AND user NOT NULL</code></pre>
<p>This will select all of the rating data (movie_title, user, and rating) from the movies table with a rating &gt; 4 and a not-null user</p>
</div>
<div id="section-functions-2" class="section level3" number="10.1.3">
<h3><span class="header-section-number">10.1.3</span> Functions</h3>
<p>We can use aggregate functions like sum, min, max, count, or average with group by to apply that function to each group.</p>
<p>Remember that your group by variable must be included in your select statement!</p>
<pre><code>-- valid
SELECT movie_title, AVG(rating) 
    FROM movies 
    GROUP BY movie_title 

-- invalid (we wouldn&#39;t know which avg goes with which movie!!)
SELECT AVG(rating) 
    FROM movies 
    GROUP BY movie_title </code></pre>
<p>We can also specify what we want the resulting aggregate column to be called. The above example would give us nicer output with this code:</p>
<pre><code>SELECT movie_title, AVG(rating) AS rating_avg
    FROM movies 
    GROUP BY movie_title </code></pre>
<p>We can limit the number of results returned, find only unique values, and sort our results as well.</p>
<pre><code>SELECT DISTINCT student_id, student_full_name 
    FROM assignments 
    ORDER BY student_full_name DESC 
    LIMIT 100</code></pre>
<p>This query will grab the first 100 distinct students (uniqueness determined by id and full name) sorted in reverse alphabetical order.</p>
</div>
<div id="section-having" class="section level3" number="10.1.4">
<h3><span class="header-section-number">10.1.4</span> <code>HAVING</code></h3>
<p><code>HAVING</code> is the equivalent function of <code>WHERE</code> for aggregate conditions. For example,</p>
<pre><code>SELECT movie_title, AVG(rating) AS rating_avg 
    FROM movies 
    GROUP BY movie_title 
    HAVING rating_avg &lt; 2</code></pre>
<p>This pulls all the movies and their average ratings that had an average rating less than 2.</p>
</div>
<div id="section-withas-and-subqueries" class="section level3" number="10.1.5">
<h3><span class="header-section-number">10.1.5</span> <code>WITH</code>/<code>AS</code> and Subqueries</h3>
<p>Subqueries are very powerful and come in two syntatical forms. They allow us to create temporary tables which only exist for that query
then disappear.</p>
<pre><code>SELECT employee_id, first_name, last_name, salary 
    FROM employees 
    WHERE salary = (
        SELECT MAX(salary) 
        FROM employees
    ) 
    ORDER BY first_name, last_name</code></pre>
<p>This syntax is equivalent to the following:</p>
<pre><code>WITH temp_table AS (SELECT MAX(salary) FROM employees)
    SELECT employee_id, first_name, last_name, salary 
    ORDER BY first_name, last_name
</code></pre>
</div>
<div id="section-joins" class="section level3" number="10.1.6">
<h3><span class="header-section-number">10.1.6</span> Joins</h3>
<p>Joins work the same way as they did in the tidyverse. There are a few types of joins:</p>
<ul>
<li>“Inner joins” produce results only where the linking variable appears on both tables</li>
<li>“Outer joins” produce results with all data, and fills in missing values as necessary
<ul>
<li>Left join keeps only observations from the first specified data if their is no match.</li>
<li>Right join keeps only observations from the second data</li>
<li>Full join keeps everything</li>
</ul></li>
</ul>
<p>Here’s an example SQL query using two tables (movies, users)</p>
<pre><code>SELECT users.*, count(movie_id) 
    FROM users 
    LEFT JOIN movies 
        ON users.user_id = movies.viewer_id 
    GROUP BY users.user_id 
    LIMIT 10</code></pre>
<p>This will select the first 10 users from the users table (users.*) and add a new column with the count of the number of movies they saw.</p>
<p>If both tables had a field called user_id that we wanted to join on, we could say <code>LEFT JOIN movies ON user_id</code> instead of specifying
what the column is called in each table. If the column name is ambiguous (because it’s present in both tables), a GROUP BY or ORDER BY or SELECT
should specify which table to take the column from by saying <code>table.column</code></p>
</div>
</div>
<div id="section-the-sqldf-package" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> The <code>sqldf</code> package</h2>
<p>The main package we’ll be using to convert SQL commands to R manipulations is <code>sqldf</code>.</p>
<p>Here’s an example using the same data from the Tidy chapter.</p>
<p>Data comes from fivethirtyeight.com</p>
<div class="sourceCode" id="section-cb780"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb780-1"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb780-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="section-cb780-2"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb780-2"></a><span class="kw">library</span>(tidyr)</span>
<span id="section-cb780-3"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb780-3"></a><span class="kw">library</span>(readr)</span>
<span id="section-cb780-4"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb780-4"></a><span class="kw">library</span>(tidyverse)</span>
<span id="section-cb780-5"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb780-5"></a>mayors&lt;-<span class="kw">read_csv</span>(<span class="st">&quot;../Datasets/Mayors.csv&quot;</span>)</span>
<span id="section-cb780-6"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb780-6"></a>tweets&lt;-<span class="kw">read_csv</span>(<span class="st">&quot;C:/Users/maria/OneDrive/WUSTL/2019-20/PDS/Tweets.csv&quot;</span>)</span></code></pre></div>
<p><code>mayors</code> and <code>tweets</code> are tibbles, but we want to operate our SQL queries on data frames</p>
<div class="sourceCode" id="section-cb781"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb781-1"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb781-1"></a>mayorsDF &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(mayors)</span>
<span id="section-cb781-2"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb781-2"></a>tweetsDF &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(tweets)</span></code></pre></div>
<p>Now we can start using our newfound SQL powers to truly explore our data. For a warm-up, let’s count how many mayors are present in our dataset.</p>
<div class="sourceCode" id="section-cb782"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb782-1"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb782-1"></a><span class="kw">library</span>(sqldf)</span>
<span id="section-cb782-2"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb782-2"></a><span class="kw">sqldf</span>( <span class="st">&quot;SELECT COUNT(DISTINCT FullName) </span></span>
<span id="section-cb782-3"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb782-3"></a><span class="st">            FROM mayorsDF&quot;</span> )</span></code></pre></div>
<pre><code>##   COUNT(DISTINCT FullName)
## 1                     1406</code></pre>
<p>We can confirm this with our tidy skills:</p>
<div class="sourceCode" id="section-cb784"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb784-1"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb784-1"></a>mayors <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb784-2"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb784-2"></a><span class="st">    </span><span class="kw">select</span>(<span class="st">&quot;FullName&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="section-cb784-3"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb784-3"></a><span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(FullName)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb784-4"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb784-4"></a><span class="st">    </span><span class="kw">n_distinct</span>()</span></code></pre></div>
<pre><code>## [1] 1406</code></pre>
<p>Note that we need to filter out NA/null values from the dataset before taking unique values in tidy. Tidy counts null as a unique value.</p>
<p>How about adding a column to the mayors dataset that counts the number of tweets they have made?</p>
<p>With SQL:</p>
<div class="sourceCode" id="section-cb786"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb786-1"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb786-1"></a>mayors_newDF &lt;-<span class="st"> </span><span class="kw">sqldf</span>( <span class="st">&quot;SELECT mayorsDF.*, COUNT(TweetID) AS nTweets</span></span>
<span id="section-cb786-2"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb786-2"></a><span class="st">                            FROM mayorsDF </span></span>
<span id="section-cb786-3"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb786-3"></a><span class="st">                            INNER JOIN tweetsDF </span></span>
<span id="section-cb786-4"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb786-4"></a><span class="st">                            ON mayorsDF.TwitterHandle = tweetsDF.ScreenName </span></span>
<span id="section-cb786-5"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb786-5"></a><span class="st">                            GROUP BY MayorID</span></span>
<span id="section-cb786-6"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb786-6"></a><span class="st">                            ORDER BY nTweets DESC, FullName ASC&quot;</span> )</span>
<span id="section-cb786-7"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb786-7"></a><span class="kw">head</span>(mayors_newDF[<span class="kw">c</span>(<span class="st">&quot;MayorID&quot;</span>, <span class="st">&quot;FullName&quot;</span>, <span class="st">&quot;TwitterHandle&quot;</span>, <span class="st">&quot;nTweets&quot;</span>)], <span class="dt">n=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    MayorID          FullName   TwitterHandle nTweets
## 1      902    Derek Armstead  derek_armstead    3200
## 2     1143      Ed Pawlowski    ed_pawlowski    3200
## 3      778      Emily Larson larsonforduluth    3200
## 4     1071     Greg Peterson      dublinohio    3200
## 5      812  Jason L. Shelton tupmayorsoffice    3200
## 6     1141        Jim Kenney     phillymayor    3200
## 7      498     Rahm Emmanuel   chicagosmayor    3200
## 8      443 Thomas A. Masters    mayormasters    3200
## 9       11  William Stimpson   mayorstimpson    3200
## 10     715        Andy Schor       andyschor    3199</code></pre>
<p>With tidy:</p>
<div class="sourceCode" id="section-cb788"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb788-1"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb788-1"></a>tweetCounts &lt;-<span class="st"> </span>tweets <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb788-2"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb788-2"></a><span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(ScreenName)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb788-3"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb788-3"></a><span class="st">    </span><span class="kw">group_by</span>(ScreenName) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb788-4"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb788-4"></a><span class="st">    </span><span class="kw">tally</span>()</span>
<span id="section-cb788-5"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb788-5"></a>mayors_new &lt;-<span class="st"> </span>mayors <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb788-6"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb788-6"></a><span class="st">    </span><span class="kw">inner_join</span>(tweetCounts, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;TwitterHandle&quot;</span>=<span class="st">&quot;ScreenName&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb788-7"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb788-7"></a><span class="st">    </span><span class="kw">group_by</span>(MayorID) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb788-8"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb788-8"></a><span class="st">    </span><span class="kw">arrange</span>(FullName) <span class="op">%&gt;%</span></span>
<span id="section-cb788-9"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb788-9"></a><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb788-10"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb788-10"></a><span class="st">    </span><span class="kw">select</span>(<span class="st">&quot;MayorID&quot;</span>, <span class="st">&quot;FullName&quot;</span>, <span class="st">&quot;TwitterHandle&quot;</span>, <span class="st">&quot;n&quot;</span>)</span>
<span id="section-cb788-11"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-cb788-11"></a>mayors_new</span></code></pre></div>
<pre><code>## # A tibble: 572 x 4
## # Groups:   MayorID [572]
##    MayorID FullName          TwitterHandle       n
##      &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;           &lt;int&gt;
##  1     902 Derek Armstead    derek_armstead   3200
##  2    1143 Ed Pawlowski      ed_pawlowski     3200
##  3     778 Emily Larson      larsonforduluth  3200
##  4    1071 Greg Peterson     dublinohio       3200
##  5     812 Jason L. Shelton  tupmayorsoffice  3200
##  6    1141 Jim Kenney        phillymayor      3200
##  7     498 Rahm Emmanuel     chicagosmayor    3200
##  8     443 Thomas A. Masters mayormasters     3200
##  9      11 William Stimpson  mayorstimpson    3200
## 10     715 Andy Schor        andyschor        3199
## # ... with 562 more rows</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-functions-and-packages.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-machine-learning.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
