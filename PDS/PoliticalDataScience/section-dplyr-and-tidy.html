<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 dplyr and tidy | Political Data Science</title>
  <meta name="description" content="7 dplyr and tidy | Political Data Science" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="7 dplyr and tidy | Political Data Science" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 dplyr and tidy | Political Data Science" />
  
  
  

<meta name="author" content="Jacob Montgomery and Mariah Yelenick" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="section-data-visualization-in-r.html"/>
<link rel="next" href="section-more-useful-packages.html"/>
<script src="libs/header-attrs-2.1/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Don’t be a clown</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#section-as-easy-as-cake"><i class="fa fa-check"></i><b>1.1</b> As easy as cake</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="index.html"><a href="index.html#section-coding"><i class="fa fa-check"></i><b>1.1.1</b> Coding</a></li>
<li class="chapter" data-level="1.1.2" data-path="index.html"><a href="index.html#section-data-acquision"><i class="fa fa-check"></i><b>1.1.2</b> Data acquision</a></li>
<li class="chapter" data-level="1.1.3" data-path="index.html"><a href="index.html#section-algorithms"><i class="fa fa-check"></i><b>1.1.3</b> Algorithms</a></li>
<li class="chapter" data-level="1.1.4" data-path="index.html"><a href="index.html#section-domain-knowledge"><i class="fa fa-check"></i><b>1.1.4</b> Domain knowledge</a></li>
<li class="chapter" data-level="1.1.5" data-path="index.html"><a href="index.html#section-putting-it-together"><i class="fa fa-check"></i><b>1.1.5</b> Putting it together</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#section-class-structures"><i class="fa fa-check"></i><b>1.2</b> Class structures</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#section-learning-objective-1-team-based-learning"><i class="fa fa-check"></i><b>1.2.1</b> Learning objective #1: Team based learning</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#section-learning-objective-2-show-up-ready"><i class="fa fa-check"></i><b>1.2.2</b> Learning objective #2: Show up ready</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#section-learning-objective-3-how-is-this-going-to-work"><i class="fa fa-check"></i><b>1.2.3</b> Learning objective #3: How is this going to work?</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#section-interactive-r-environment-not-currently-working"><i class="fa fa-check"></i><b>1.3</b> Interactive R Environment (not currently working)</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="section-getting-started-in-r.html"><a href="section-getting-started-in-r.html"><i class="fa fa-check"></i><b>2</b> Getting Started in R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="section-getting-started-in-r.html"><a href="section-getting-started-in-r.html#section-learning-objectives"><i class="fa fa-check"></i><b>2.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="2.2" data-path="section-getting-started-in-r.html"><a href="section-getting-started-in-r.html#section-assigning-values-to-objects"><i class="fa fa-check"></i><b>2.2</b> Assigning values to objects</a></li>
<li class="chapter" data-level="2.3" data-path="section-getting-started-in-r.html"><a href="section-getting-started-in-r.html#section-r-as-a-calculator"><i class="fa fa-check"></i><b>2.3</b> R as a calculator</a></li>
<li class="chapter" data-level="2.4" data-path="section-getting-started-in-r.html"><a href="section-getting-started-in-r.html#section-the-global-environment-and-how-to-clean-it"><i class="fa fa-check"></i><b>2.4</b> The global environment and how to clean it</a></li>
<li class="chapter" data-level="2.5" data-path="section-getting-started-in-r.html"><a href="section-getting-started-in-r.html#section-getting-help"><i class="fa fa-check"></i><b>2.5</b> Getting help</a></li>
<li class="chapter" data-level="2.6" data-path="section-getting-started-in-r.html"><a href="section-getting-started-in-r.html#section-installing-packages"><i class="fa fa-check"></i><b>2.6</b> Installing packages</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html"><i class="fa fa-check"></i><b>3</b> Data Types in R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-functions"><i class="fa fa-check"></i><b>3.1</b> Functions</a></li>
<li class="chapter" data-level="3.2" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-vectors"><i class="fa fa-check"></i><b>3.2</b> Vectors</a></li>
<li class="chapter" data-level="3.3" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-functions-and-vectors"><i class="fa fa-check"></i><b>3.3</b> Functions and vectors</a></li>
<li class="chapter" data-level="3.4" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-logicalsbooleans"><i class="fa fa-check"></i><b>3.4</b> Logicals/Booleans</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-boolean-logic"><i class="fa fa-check"></i><b>3.4.1</b> Boolean logic</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-charactersstrings"><i class="fa fa-check"></i><b>3.5</b> Characters/Strings</a></li>
<li class="chapter" data-level="3.6" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-matrices"><i class="fa fa-check"></i><b>3.6</b> Matrices</a></li>
<li class="chapter" data-level="3.7" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-matrix-algebra-optional"><i class="fa fa-check"></i><b>3.7</b> Matrix algebra (optional)</a></li>
<li class="chapter" data-level="3.8" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-lists"><i class="fa fa-check"></i><b>3.8</b> Lists</a></li>
<li class="chapter" data-level="3.9" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-arrays"><i class="fa fa-check"></i><b>3.9</b> Arrays</a></li>
<li class="chapter" data-level="3.10" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-dataframes"><i class="fa fa-check"></i><b>3.10</b> Dataframes</a></li>
<li class="chapter" data-level="3.11" data-path="section-data-types-in-r.html"><a href="section-data-types-in-r.html#section-general-info"><i class="fa fa-check"></i><b>3.11</b> General info</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html"><i class="fa fa-check"></i><b>4</b> Files, For Loops, and Functions</a>
<ul>
<li class="chapter" data-level="4.1" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-the-working-directory"><i class="fa fa-check"></i><b>4.1</b> The working directory</a></li>
<li class="chapter" data-level="4.2" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-input-and-output"><i class="fa fa-check"></i><b>4.2</b> Input and output</a></li>
<li class="chapter" data-level="4.3" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-if-else-ifelse"><i class="fa fa-check"></i><b>4.3</b> if, else, ifelse</a></li>
<li class="chapter" data-level="4.4" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-repeat-and-while"><i class="fa fa-check"></i><b>4.4</b> repeat and while</a></li>
<li class="chapter" data-level="4.5" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-for-loops"><i class="fa fa-check"></i><b>4.5</b> for loops</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-next-and-break"><i class="fa fa-check"></i><b>4.5.1</b> next and break</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-functions-1"><i class="fa fa-check"></i><b>4.6</b> Functions</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-the-basics"><i class="fa fa-check"></i><b>4.6.1</b> The basics</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-setting-defaults"><i class="fa fa-check"></i><b>4.7</b> Setting defaults</a></li>
<li class="chapter" data-level="4.8" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-scope"><i class="fa fa-check"></i><b>4.8</b> Scope</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-advanced-scope-topics"><i class="fa fa-check"></i><b>4.8.1</b> Advanced scope topics</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-debugging"><i class="fa fa-check"></i><b>4.9</b> Debugging</a></li>
<li class="chapter" data-level="4.10" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-benchmarking-and-code-improvements"><i class="fa fa-check"></i><b>4.10</b> Benchmarking and code improvements</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-vectorizing"><i class="fa fa-check"></i><b>4.10.1</b> Vectorizing</a></li>
<li class="chapter" data-level="4.10.2" data-path="section-files-for-loops-and-functions.html"><a href="section-files-for-loops-and-functions.html#section-pastecollapse-and-copies"><i class="fa fa-check"></i><b>4.10.2</b> Paste/collapse and copies</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-version-control.html"><a href="section-version-control.html"><i class="fa fa-check"></i><b>5</b> Version Control</a>
<ul>
<li class="chapter" data-level="5.1" data-path="section-version-control.html"><a href="section-version-control.html#section-why-version-control"><i class="fa fa-check"></i><b>5.1</b> Why version control?</a></li>
<li class="chapter" data-level="5.2" data-path="section-version-control.html"><a href="section-version-control.html#section-setup"><i class="fa fa-check"></i><b>5.2</b> Setup</a></li>
<li class="chapter" data-level="5.3" data-path="section-version-control.html"><a href="section-version-control.html#section-workflow"><i class="fa fa-check"></i><b>5.3</b> Workflow</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="section-version-control.html"><a href="section-version-control.html#section-pull"><i class="fa fa-check"></i><b>5.3.1</b> Pull</a></li>
<li class="chapter" data-level="5.3.2" data-path="section-version-control.html"><a href="section-version-control.html#section-commit"><i class="fa fa-check"></i><b>5.3.2</b> Commit</a></li>
<li class="chapter" data-level="5.3.3" data-path="section-version-control.html"><a href="section-version-control.html#section-push"><i class="fa fa-check"></i><b>5.3.3</b> Push</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="section-version-control.html"><a href="section-version-control.html#section-branches"><i class="fa fa-check"></i><b>5.4</b> Branches</a></li>
<li class="chapter" data-level="5.5" data-path="section-version-control.html"><a href="section-version-control.html#section-forking"><i class="fa fa-check"></i><b>5.5</b> Forking</a></li>
<li class="chapter" data-level="5.6" data-path="section-version-control.html"><a href="section-version-control.html#section-reverting"><i class="fa fa-check"></i><b>5.6</b> Reverting</a></li>
<li class="chapter" data-level="5.7" data-path="section-version-control.html"><a href="section-version-control.html#section-conflict-management"><i class="fa fa-check"></i><b>5.7</b> Conflict management</a></li>
<li class="chapter" data-level="5.8" data-path="section-version-control.html"><a href="section-version-control.html#section-version-control-in-rstudio"><i class="fa fa-check"></i><b>5.8</b> Version Control in RStudio</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="section-data-visualization-in-r.html"><a href="section-data-visualization-in-r.html"><i class="fa fa-check"></i><b>6</b> Data Visualization in R</a>
<ul>
<li class="chapter" data-level="6.1" data-path="section-data-visualization-in-r.html"><a href="section-data-visualization-in-r.html#section-intro-to-ggplot2"><i class="fa fa-check"></i><b>6.1</b> Intro to ggplot2</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="section-data-visualization-in-r.html"><a href="section-data-visualization-in-r.html#section-example"><i class="fa fa-check"></i><b>6.1.1</b> Example</a></li>
<li class="chapter" data-level="6.1.2" data-path="section-data-visualization-in-r.html"><a href="section-data-visualization-in-r.html#section-aesthetics"><i class="fa fa-check"></i><b>6.1.2</b> Aesthetics</a></li>
<li class="chapter" data-level="6.1.3" data-path="section-data-visualization-in-r.html"><a href="section-data-visualization-in-r.html#section-facets"><i class="fa fa-check"></i><b>6.1.3</b> Facets</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="section-data-visualization-in-r.html"><a href="section-data-visualization-in-r.html#section-more-geom-options"><i class="fa fa-check"></i><b>6.2</b> More <code>geom</code> options</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html"><i class="fa fa-check"></i><b>7</b> dplyr and tidy</a>
<ul>
<li class="chapter" data-level="7.1" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-into-the-tidyverse"><i class="fa fa-check"></i><b>7.1</b> Into the tidyverse</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-our-example"><i class="fa fa-check"></i><b>7.1.1</b> Our example</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-back-to-dplyr"><i class="fa fa-check"></i><b>7.2</b> Back to <code>dplyr</code></a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-filter"><i class="fa fa-check"></i><b>7.2.1</b> <code>filter</code></a></li>
<li class="chapter" data-level="7.2.2" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-arrange"><i class="fa fa-check"></i><b>7.2.2</b> <code>arrange</code></a></li>
<li class="chapter" data-level="7.2.3" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-select"><i class="fa fa-check"></i><b>7.2.3</b> <code>select</code></a></li>
<li class="chapter" data-level="7.2.4" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-mutate"><i class="fa fa-check"></i><b>7.2.4</b> <code>mutate</code></a></li>
<li class="chapter" data-level="7.2.5" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-summarise"><i class="fa fa-check"></i><b>7.2.5</b> <code>summarise</code></a></li>
<li class="chapter" data-level="7.2.6" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-piping"><i class="fa fa-check"></i><b>7.2.6</b> Piping</a></li>
<li class="chapter" data-level="7.2.7" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-pivots"><i class="fa fa-check"></i><b>7.2.7</b> Pivots</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-relational-data"><i class="fa fa-check"></i><b>7.3</b> Relational data</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-mutating-join"><i class="fa fa-check"></i><b>7.3.1</b> Mutating join</a></li>
<li class="chapter" data-level="7.3.2" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-joins-topography"><i class="fa fa-check"></i><b>7.3.2</b> Joins topography</a></li>
<li class="chapter" data-level="7.3.3" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-many-and-one-to-many"><i class="fa fa-check"></i><b>7.3.3</b> Many and one-to-many</a></li>
<li class="chapter" data-level="7.3.4" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-filtering-joins"><i class="fa fa-check"></i><b>7.3.4</b> Filtering joins</a></li>
<li class="chapter" data-level="7.3.5" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-set-operations"><i class="fa fa-check"></i><b>7.3.5</b> Set operations</a></li>
<li class="chapter" data-level="7.3.6" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-exercise"><i class="fa fa-check"></i><b>7.3.6</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-stringr"><i class="fa fa-check"></i><b>7.4</b> <code>stringr</code></a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-things-you-havent-thought-about-strings"><i class="fa fa-check"></i><b>7.4.1</b> Things you haven’t thought about strings</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-pipes-and-maps"><i class="fa fa-check"></i><b>7.5</b> Pipes and maps</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-limitations-of-pipes"><i class="fa fa-check"></i><b>7.5.1</b> Limitations of Pipes</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-map"><i class="fa fa-check"></i><b>7.6</b> <code>map</code></a></li>
<li class="chapter" data-level="7.7" data-path="section-dplyr-and-tidy.html"><a href="section-dplyr-and-tidy.html#section-walk-purrr-and-more"><i class="fa fa-check"></i><b>7.7</b> walk, purrr, and more</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="section-more-useful-packages.html"><a href="section-more-useful-packages.html"><i class="fa fa-check"></i><b>8</b> More useful packages</a>
<ul>
<li class="chapter" data-level="8.1" data-path="section-more-useful-packages.html"><a href="section-more-useful-packages.html#section-stringr-1"><i class="fa fa-check"></i><b>8.1</b> <code>stringr</code></a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="section-more-useful-packages.html"><a href="section-more-useful-packages.html#section-things-you-havent-thought-about-strings-1"><i class="fa fa-check"></i><b>8.1.1</b> Things you haven’t thought about strings</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html"><i class="fa fa-check"></i><b>9</b> Functions and Packages</a>
<ul>
<li class="chapter" data-level="9.1" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-apply-and-its-friends"><i class="fa fa-check"></i><b>9.1</b> <code>apply</code> and its friends</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-apply"><i class="fa fa-check"></i><b>9.1.1</b> <code>apply</code></a></li>
<li class="chapter" data-level="9.1.2" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-lapply"><i class="fa fa-check"></i><b>9.1.2</b> <code>lapply</code></a></li>
<li class="chapter" data-level="9.1.3" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-sapply"><i class="fa fa-check"></i><b>9.1.3</b> <code>sapply</code></a></li>
<li class="chapter" data-level="9.1.4" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-tapply"><i class="fa fa-check"></i><b>9.1.4</b> <code>tapply</code></a></li>
<li class="chapter" data-level="9.1.5" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-sweep"><i class="fa fa-check"></i><b>9.1.5</b> <code>sweep</code></a></li>
<li class="chapter" data-level="9.1.6" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-by"><i class="fa fa-check"></i><b>9.1.6</b> <code>by</code></a></li>
<li class="chapter" data-level="9.1.7" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-vapply-and-more"><i class="fa fa-check"></i><b>9.1.7</b> <code>vapply</code> And more</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="section-functions-and-packages.html"><a href="section-functions-and-packages.html#section-plyr"><i class="fa fa-check"></i><b>9.2</b> <code>plyr</code></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html"><i class="fa fa-check"></i><b>10</b> Using SQL syntax on an R dataframe</a>
<ul>
<li class="chapter" data-level="10.1" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-sql"><i class="fa fa-check"></i><b>10.1</b> SQL</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-select-and-from"><i class="fa fa-check"></i><b>10.1.1</b> <code>SELECT</code> and <code>FROM</code></a></li>
<li class="chapter" data-level="10.1.2" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-where"><i class="fa fa-check"></i><b>10.1.2</b> <code>WHERE</code></a></li>
<li class="chapter" data-level="10.1.3" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-functions-2"><i class="fa fa-check"></i><b>10.1.3</b> Functions</a></li>
<li class="chapter" data-level="10.1.4" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-having"><i class="fa fa-check"></i><b>10.1.4</b> <code>HAVING</code></a></li>
<li class="chapter" data-level="10.1.5" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-withas-and-subqueries"><i class="fa fa-check"></i><b>10.1.5</b> <code>WITH</code>/<code>AS</code> and Subqueries</a></li>
<li class="chapter" data-level="10.1.6" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-joins"><i class="fa fa-check"></i><b>10.1.6</b> Joins</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="section-using-sql-syntax-on-an-r-dataframe.html"><a href="section-using-sql-syntax-on-an-r-dataframe.html#section-the-sqldf-package"><i class="fa fa-check"></i><b>10.2</b> The <code>sqldf</code> package</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="section-machine-learning.html"><a href="section-machine-learning.html"><i class="fa fa-check"></i><b>11</b> Machine Learning</a>
<ul>
<li class="chapter" data-level="11.1" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-supervised-learning"><i class="fa fa-check"></i><b>11.1</b> Supervised Learning</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-the-gist"><i class="fa fa-check"></i><b>11.1.1</b> The Gist</a></li>
<li class="chapter" data-level="11.1.2" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-what-could-go-wrong"><i class="fa fa-check"></i><b>11.1.2</b> What could go wrong?</a></li>
<li class="chapter" data-level="11.1.3" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-example-predicting-presidential-elections-with-vote-share"><i class="fa fa-check"></i><b>11.1.3</b> Example: Predicting presidential elections with vote share</a></li>
<li class="chapter" data-level="11.1.4" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-the-complexity-of-keeping-it-simple"><i class="fa fa-check"></i><b>11.1.4</b> The complexity of keeping it simple</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-classification"><i class="fa fa-check"></i><b>11.2</b> Classification</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-classification-basics-binary-outcomes"><i class="fa fa-check"></i><b>11.2.1</b> Classification basics: Binary outcomes</a></li>
<li class="chapter" data-level="11.2.2" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-the-linear-classifier-aka-logit"><i class="fa fa-check"></i><b>11.2.2</b> The linear classifier (AKA Logit)</a></li>
<li class="chapter" data-level="11.2.3" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-more-models"><i class="fa fa-check"></i><b>11.2.3</b> More models</a></li>
<li class="chapter" data-level="11.2.4" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-random-forests"><i class="fa fa-check"></i><b>11.2.4</b> Random forests</a></li>
<li class="chapter" data-level="11.2.5" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-k-nearest-neighbors"><i class="fa fa-check"></i><b>11.2.5</b> K Nearest Neighbors</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="section-machine-learning.html"><a href="section-machine-learning.html#section-putting-that-in-action"><i class="fa fa-check"></i><b>11.3</b> Putting that in action</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="section-causality.html"><a href="section-causality.html"><i class="fa fa-check"></i><b>12</b> Causality</a>
<ul>
<li class="chapter" data-level="12.1" data-path="section-causality.html"><a href="section-causality.html#section-correlation-and-causation"><i class="fa fa-check"></i><b>12.1</b> Correlation and causation</a></li>
<li class="chapter" data-level="12.2" data-path="section-causality.html"><a href="section-causality.html#section-a-formal-definition"><i class="fa fa-check"></i><b>12.2</b> A formal definition</a></li>
<li class="chapter" data-level="12.3" data-path="section-causality.html"><a href="section-causality.html#section-formal-presentation-of-an-ate"><i class="fa fa-check"></i><b>12.3</b> Formal presentation of an ATE</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="section-causality.html"><a href="section-causality.html#section-danger"><i class="fa fa-check"></i><b>12.3.1</b> Danger!</a></li>
<li class="chapter" data-level="12.3.2" data-path="section-causality.html"><a href="section-causality.html#section-does-drinking-make-you-more-educated"><i class="fa fa-check"></i><b>12.3.2</b> Does drinking make you more educated?</a></li>
<li class="chapter" data-level="12.3.3" data-path="section-causality.html"><a href="section-causality.html#section-problem-it-can-be-way-more-subtle"><i class="fa fa-check"></i><b>12.3.3</b> Problem: It can be way more subtle</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="section-causality.html"><a href="section-causality.html#section-estimating-ate"><i class="fa fa-check"></i><b>12.4</b> Estimating ATE</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="section-causality.html"><a href="section-causality.html#section-filling-in-the-potential-values"><i class="fa fa-check"></i><b>12.4.1</b> Filling in the potential values</a></li>
<li class="chapter" data-level="12.4.2" data-path="section-causality.html"><a href="section-causality.html#section-good-causal-inference"><i class="fa fa-check"></i><b>12.4.2</b> Good causal inference</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="section-causality.html"><a href="section-causality.html#section-experiments-ab-testing"><i class="fa fa-check"></i><b>12.5</b> Experiments: A/B Testing</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="section-causality.html"><a href="section-causality.html#section-what-to-do-when-you-cant-experiment"><i class="fa fa-check"></i><b>12.5.1</b> What to do when you can’t experiment:</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="section-causality.html"><a href="section-causality.html#section-panel-data-and-fixed-effects"><i class="fa fa-check"></i><b>12.6</b> Panel data and fixed effects</a>
<ul>
<li class="chapter" data-level="12.6.1" data-path="section-causality.html"><a href="section-causality.html#section-example-are-elections-fought-over-non-economic-issues-more-when-globalization-increases"><i class="fa fa-check"></i><b>12.6.1</b> Example: Are elections fought over non-economic issues more when globalization increases?</a></li>
<li class="chapter" data-level="12.6.2" data-path="section-causality.html"><a href="section-causality.html#section-naive-regression"><i class="fa fa-check"></i><b>12.6.2</b> Naive regression</a></li>
<li class="chapter" data-level="12.6.3" data-path="section-causality.html"><a href="section-causality.html#section-fixed-effects"><i class="fa fa-check"></i><b>12.6.3</b> Fixed effects</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="section-causality.html"><a href="section-causality.html#section-difference-in-differences"><i class="fa fa-check"></i><b>12.7</b> Difference-in-differences</a>
<ul>
<li class="chapter" data-level="12.7.1" data-path="section-causality.html"><a href="section-causality.html#section-did-in-practice"><i class="fa fa-check"></i><b>12.7.1</b> DID in practice</a></li>
<li class="chapter" data-level="12.7.2" data-path="section-causality.html"><a href="section-causality.html#section-regression-discontinuity"><i class="fa fa-check"></i><b>12.7.2</b> Regression discontinuity</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Political Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-dplyr-and-tidy" class="section level1" number="7">
<h1><span class="header-section-number">7</span> dplyr and tidy</h1>
<div id="section-into-the-tidyverse" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Into the tidyverse</h2>
<ul>
<li><code>dplyr</code> is a handy package for changing data</li>
<li><code>tidyr</code> is a handy package for reshaping data</li>
<li>In combination they offer a powerful way to quickly extract insight from your data</li>
</ul>
<div id="section-our-example" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Our example</h3>
<p>Data comes from fivethirtyeight.com</p>
<div class="sourceCode" id="section-cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb502-1"><a href="section-dplyr-and-tidy.html#section-cb502-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="section-cb502-2"><a href="section-dplyr-and-tidy.html#section-cb502-2"></a><span class="kw">library</span>(tidyr)</span>
<span id="section-cb502-3"><a href="section-dplyr-and-tidy.html#section-cb502-3"></a><span class="kw">library</span>(readr)</span>
<span id="section-cb502-4"><a href="section-dplyr-and-tidy.html#section-cb502-4"></a>primaryPolls&lt;-<span class="kw">read_csv</span>(<span class="st">&#39;https://jmontgomery.github.io/PDS/Datasets/president_primary_polls_feb2020.csv&#39;</span>)</span>
<span id="section-cb502-5"><a href="section-dplyr-and-tidy.html#section-cb502-5"></a>primaryPolls<span class="op">$</span>start_date&lt;-<span class="kw">as.Date</span>(primaryPolls<span class="op">$</span>start_date, <span class="st">&quot;%m/%d/%y&quot;</span>)</span>
<span id="section-cb502-6"><a href="section-dplyr-and-tidy.html#section-cb502-6"></a></span>
<span id="section-cb502-7"><a href="section-dplyr-and-tidy.html#section-cb502-7"></a><span class="kw">class</span>(primaryPolls)</span></code></pre></div>
<pre><code>## [1] &quot;spec_tbl_df&quot; &quot;tbl_df&quot;      &quot;tbl&quot;         &quot;data.frame&quot;</code></pre>
<ul>
<li>A tibble is basically a data frame</li>
<li>They are both friendlier and more structured than traditional data frames</li>
</ul>
<div class="sourceCode" id="section-cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb504-1"><a href="section-dplyr-and-tidy.html#section-cb504-1"></a>primaryPolls</span></code></pre></div>
<pre><code>## # A tibble: 16,661 x 33
##    question_id poll_id cycle state pollster_id pollster sponsor_ids sponsors
##          &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;   
##  1      116805   63512  2020 New ~        1515 Data fo~          NA &lt;NA&gt;    
##  2      116805   63512  2020 New ~        1515 Data fo~          NA &lt;NA&gt;    
##  3      116805   63512  2020 New ~        1515 Data fo~          NA &lt;NA&gt;    
##  4      116805   63512  2020 New ~        1515 Data fo~          NA &lt;NA&gt;    
##  5      116805   63512  2020 New ~        1515 Data fo~          NA &lt;NA&gt;    
##  6      116805   63512  2020 New ~        1515 Data fo~          NA &lt;NA&gt;    
##  7      116805   63512  2020 New ~        1515 Data fo~          NA &lt;NA&gt;    
##  8      116805   63512  2020 New ~        1515 Data fo~          NA &lt;NA&gt;    
##  9      116799   63511  2020 &lt;NA&gt;          744 Ipsos             71 Reuters 
## 10      116799   63511  2020 &lt;NA&gt;          744 Ipsos             71 Reuters 
## # ... with 16,651 more rows, and 25 more variables: display_name &lt;chr&gt;,
## #   pollster_rating_id &lt;dbl&gt;, pollster_rating_name &lt;chr&gt;, fte_grade &lt;chr&gt;,
## #   sample_size &lt;dbl&gt;, population &lt;chr&gt;, population_full &lt;chr&gt;,
## #   methodology &lt;chr&gt;, office_type &lt;chr&gt;, start_date &lt;date&gt;, end_date &lt;chr&gt;,
## #   sponsor_candidate &lt;lgl&gt;, internal &lt;lgl&gt;, partisan &lt;lgl&gt;, tracking &lt;lgl&gt;,
## #   nationwide_batch &lt;lgl&gt;, created_at &lt;chr&gt;, notes &lt;chr&gt;, url &lt;chr&gt;,
## #   stage &lt;chr&gt;, party &lt;chr&gt;, answer &lt;chr&gt;, candidate_id &lt;dbl&gt;,
## #   candidate_name &lt;chr&gt;, pct &lt;dbl&gt;</code></pre>
<p>You can also print the first 10 rows of all the columns</p>
<div class="sourceCode" id="section-cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb506-1"><a href="section-dplyr-and-tidy.html#section-cb506-1"></a><span class="kw">print</span>(primaryPolls, <span class="dt">width=</span><span class="ot">Inf</span>)</span></code></pre></div>
<pre><code>## # A tibble: 16,661 x 33
##    question_id poll_id cycle state         pollster_id pollster         
##          &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;            
##  1      116805   63512  2020 New Hampshire        1515 Data for Progress
##  2      116805   63512  2020 New Hampshire        1515 Data for Progress
##  3      116805   63512  2020 New Hampshire        1515 Data for Progress
##  4      116805   63512  2020 New Hampshire        1515 Data for Progress
##  5      116805   63512  2020 New Hampshire        1515 Data for Progress
##  6      116805   63512  2020 New Hampshire        1515 Data for Progress
##  7      116805   63512  2020 New Hampshire        1515 Data for Progress
##  8      116805   63512  2020 New Hampshire        1515 Data for Progress
##  9      116799   63511  2020 &lt;NA&gt;                  744 Ipsos            
## 10      116799   63511  2020 &lt;NA&gt;                  744 Ipsos            
##    sponsor_ids sponsors display_name      pollster_rating_id
##          &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;                          &lt;dbl&gt;
##  1          NA &lt;NA&gt;     Data for Progress                522
##  2          NA &lt;NA&gt;     Data for Progress                522
##  3          NA &lt;NA&gt;     Data for Progress                522
##  4          NA &lt;NA&gt;     Data for Progress                522
##  5          NA &lt;NA&gt;     Data for Progress                522
##  6          NA &lt;NA&gt;     Data for Progress                522
##  7          NA &lt;NA&gt;     Data for Progress                522
##  8          NA &lt;NA&gt;     Data for Progress                522
##  9          71 Reuters  Ipsos                            154
## 10          71 Reuters  Ipsos                            154
##    pollster_rating_name fte_grade sample_size population population_full
##    &lt;chr&gt;                &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;          
##  1 Data for Progress    B/C              1295 lv         lv-d           
##  2 Data for Progress    B/C              1295 lv         lv-d           
##  3 Data for Progress    B/C              1295 lv         lv-d           
##  4 Data for Progress    B/C              1295 lv         lv-d           
##  5 Data for Progress    B/C              1295 lv         lv-d           
##  6 Data for Progress    B/C              1295 lv         lv-d           
##  7 Data for Progress    B/C              1295 lv         lv-d           
##  8 Data for Progress    B/C              1295 lv         lv-d           
##  9 Ipsos                B-                556 rv         rv-d           
## 10 Ipsos                B-                556 rv         rv-d           
##    methodology office_type    start_date end_date sponsor_candidate internal
##    &lt;chr&gt;       &lt;chr&gt;          &lt;date&gt;     &lt;chr&gt;    &lt;lgl&gt;             &lt;lgl&gt;   
##  1 Text        U.S. President 2020-02-07 2/10/20  NA                FALSE   
##  2 Text        U.S. President 2020-02-07 2/10/20  NA                FALSE   
##  3 Text        U.S. President 2020-02-07 2/10/20  NA                FALSE   
##  4 Text        U.S. President 2020-02-07 2/10/20  NA                FALSE   
##  5 Text        U.S. President 2020-02-07 2/10/20  NA                FALSE   
##  6 Text        U.S. President 2020-02-07 2/10/20  NA                FALSE   
##  7 Text        U.S. President 2020-02-07 2/10/20  NA                FALSE   
##  8 Text        U.S. President 2020-02-07 2/10/20  NA                FALSE   
##  9 Online      U.S. President 2020-02-06 2/10/20  NA                FALSE   
## 10 Online      U.S. President 2020-02-06 2/10/20  NA                FALSE   
##    partisan tracking nationwide_batch created_at    notes
##    &lt;lgl&gt;    &lt;lgl&gt;    &lt;lgl&gt;            &lt;chr&gt;         &lt;chr&gt;
##  1 NA       FALSE    FALSE            2/10/20 21:47 &lt;NA&gt; 
##  2 NA       FALSE    FALSE            2/10/20 21:47 &lt;NA&gt; 
##  3 NA       FALSE    FALSE            2/10/20 21:47 &lt;NA&gt; 
##  4 NA       FALSE    FALSE            2/10/20 21:47 &lt;NA&gt; 
##  5 NA       FALSE    FALSE            2/10/20 21:47 &lt;NA&gt; 
##  6 NA       FALSE    FALSE            2/10/20 21:47 &lt;NA&gt; 
##  7 NA       FALSE    FALSE            2/10/20 21:47 &lt;NA&gt; 
##  8 NA       FALSE    FALSE            2/10/20 21:47 &lt;NA&gt; 
##  9 NA       FALSE    FALSE            2/10/20 18:27 &lt;NA&gt; 
## 10 NA       FALSE    FALSE            2/10/20 18:27 &lt;NA&gt; 
##    url                                                                          
##    &lt;chr&gt;                                                                        
##  1 http://filesforprogress.org/datasets/2020/2/nh/new_hampshire_primary.pdf     
##  2 http://filesforprogress.org/datasets/2020/2/nh/new_hampshire_primary.pdf     
##  3 http://filesforprogress.org/datasets/2020/2/nh/new_hampshire_primary.pdf     
##  4 http://filesforprogress.org/datasets/2020/2/nh/new_hampshire_primary.pdf     
##  5 http://filesforprogress.org/datasets/2020/2/nh/new_hampshire_primary.pdf     
##  6 http://filesforprogress.org/datasets/2020/2/nh/new_hampshire_primary.pdf     
##  7 http://filesforprogress.org/datasets/2020/2/nh/new_hampshire_primary.pdf     
##  8 http://filesforprogress.org/datasets/2020/2/nh/new_hampshire_primary.pdf     
##  9 https://www.ipsos.com/sites/default/files/ct/news/documents/2020-02/topline_~
## 10 https://www.ipsos.com/sites/default/files/ct/news/documents/2020-02/topline_~
##    stage   party answer    candidate_id candidate_name        pct
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt;
##  1 primary DEM   Sanders          13257 Bernard Sanders        28
##  2 primary DEM   Yang             13329 Andrew Yang             5
##  3 primary DEM   Buttigieg        13345 Pete Buttigieg         26
##  4 primary DEM   Biden            13256 Joseph R. Biden Jr.     9
##  5 primary DEM   Gabbard          13343 Tulsi Gabbard           3
##  6 primary DEM   Klobuchar        13310 Amy Klobuchar          13
##  7 primary DEM   Warren           13258 Elizabeth Warren       14
##  8 primary DEM   Steyer           13327 Tom Steyer              3
##  9 primary DEM   Sanders          13257 Bernard Sanders        20
## 10 primary DEM   Biden            13256 Joseph R. Biden Jr.    17
## # ... with 16,651 more rows</code></pre>
<ul>
<li>You can access elements basically the same way</li>
<li>They never allow partial matching (which is evil anyways)
<ul>
<li>Partial matching allows you to type the first few characters of a column name and it will figure out which one you meant</li>
</ul></li>
<li>You can use <code>as.tibble</code> or <code>as.data.frame</code> to jump back and forth</li>
</ul>
</div>
</div>
<div id="section-back-to-dplyr" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Back to <code>dplyr</code></h2>
<ul>
<li>Subset data by rows: <code>filter</code></li>
<li>Reorder by rows: <code>arrange</code></li>
<li>Subset data by column: <code>select</code></li>
<li>Create new variables as a function of other variables: <code>mutate</code></li>
<li>Collapse values down (or extract statistic): <code>summarise</code></li>
<li>We can use <code>group_by</code> to make changes in the scope</li>
</ul>
<div id="section-filter" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> <code>filter</code></h3>
<ul>
<li><code>filter</code> allows you to easily subset data using conditions as we have done before using accessors</li>
</ul>
<div class="sourceCode" id="section-cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb508-1"><a href="section-dplyr-and-tidy.html#section-cb508-1"></a><span class="kw">filter</span>(primaryPolls, candidate_name <span class="op">==</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Amy Klobuchar&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 874 x 33
##    question_id poll_id cycle state pollster_id pollster sponsor_ids sponsors
##          &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;   
##  1      116805   63512  2020 New ~        1515 Data fo~          NA &lt;NA&gt;    
##  2      116799   63511  2020 &lt;NA&gt;          744 Ipsos             71 Reuters 
##  3      116732   63489  2020 New ~        1102 Emerson~          43 7News   
##  4      116733   63490  2020 New ~         458 Suffolk~       68323 Boston ~
##  5      116743   63493  2020 New ~          23 America~          NA &lt;NA&gt;    
##  6      116798   63510  2020 New ~        1529 Elucd             NA &lt;NA&gt;    
##  7      116745   63494  2020 New ~        1470 Univers~         143 CNN     
##  8      116792   63508  2020 Cali~        1491 Capitol~          NA &lt;NA&gt;    
##  9      116763   63496  2020 &lt;NA&gt;          396 Quinnip~          NA &lt;NA&gt;    
## 10      116714   63483  2020 New ~        1102 Emerson~          43 7News   
## # ... with 864 more rows, and 25 more variables: display_name &lt;chr&gt;,
## #   pollster_rating_id &lt;dbl&gt;, pollster_rating_name &lt;chr&gt;, fte_grade &lt;chr&gt;,
## #   sample_size &lt;dbl&gt;, population &lt;chr&gt;, population_full &lt;chr&gt;,
## #   methodology &lt;chr&gt;, office_type &lt;chr&gt;, start_date &lt;date&gt;, end_date &lt;chr&gt;,
## #   sponsor_candidate &lt;lgl&gt;, internal &lt;lgl&gt;, partisan &lt;lgl&gt;, tracking &lt;lgl&gt;,
## #   nationwide_batch &lt;lgl&gt;, created_at &lt;chr&gt;, notes &lt;chr&gt;, url &lt;chr&gt;,
## #   stage &lt;chr&gt;, party &lt;chr&gt;, answer &lt;chr&gt;, candidate_id &lt;dbl&gt;,
## #   candidate_name &lt;chr&gt;, pct &lt;dbl&gt;</code></pre>
<ul>
<li>Or you can include multiple conditions</li>
</ul>
<div class="sourceCode" id="section-cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb510-1"><a href="section-dplyr-and-tidy.html#section-cb510-1"></a><span class="kw">filter</span>(primaryPolls, </span>
<span id="section-cb510-2"><a href="section-dplyr-and-tidy.html#section-cb510-2"></a>       candidate_name <span class="op">==</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Amy Klobuchar&quot;</span>), </span>
<span id="section-cb510-3"><a href="section-dplyr-and-tidy.html#section-cb510-3"></a>       state<span class="op">==</span><span class="st">&quot;New Hampshire&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 84 x 33
##    question_id poll_id cycle state pollster_id pollster sponsor_ids sponsors
##          &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;   
##  1      116805   63512  2020 New ~        1515 Data fo~          NA &lt;NA&gt;    
##  2      116732   63489  2020 New ~        1102 Emerson~          43 7News   
##  3      116733   63490  2020 New ~         458 Suffolk~       68323 Boston ~
##  4      116743   63493  2020 New ~          23 America~          NA &lt;NA&gt;    
##  5      116798   63510  2020 New ~        1529 Elucd             NA &lt;NA&gt;    
##  6      116745   63494  2020 New ~        1470 Univers~         143 CNN     
##  7      116714   63483  2020 New ~        1102 Emerson~          43 7News   
##  8      116715   63484  2020 New ~         458 Suffolk~       68323 Boston ~
##  9      116717   63485  2020 New ~        1470 Univers~         143 CNN     
## 10      116718   63486  2020 New ~         568 YouGov           133 CBS News
## # ... with 74 more rows, and 25 more variables: display_name &lt;chr&gt;,
## #   pollster_rating_id &lt;dbl&gt;, pollster_rating_name &lt;chr&gt;, fte_grade &lt;chr&gt;,
## #   sample_size &lt;dbl&gt;, population &lt;chr&gt;, population_full &lt;chr&gt;,
## #   methodology &lt;chr&gt;, office_type &lt;chr&gt;, start_date &lt;date&gt;, end_date &lt;chr&gt;,
## #   sponsor_candidate &lt;lgl&gt;, internal &lt;lgl&gt;, partisan &lt;lgl&gt;, tracking &lt;lgl&gt;,
## #   nationwide_batch &lt;lgl&gt;, created_at &lt;chr&gt;, notes &lt;chr&gt;, url &lt;chr&gt;,
## #   stage &lt;chr&gt;, party &lt;chr&gt;, answer &lt;chr&gt;, candidate_id &lt;dbl&gt;,
## #   candidate_name &lt;chr&gt;, pct &lt;dbl&gt;</code></pre>
<ul>
<li>Everything you have already learned about boolean operators applies here.</li>
</ul>
</div>
<div id="section-arrange" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> <code>arrange</code></h3>
<ul>
<li><code>arrange</code> does the same thing, but organizes data by rows insead of subsetting by rows.</li>
</ul>
<div class="sourceCode" id="section-cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb512-1"><a href="section-dplyr-and-tidy.html#section-cb512-1"></a><span class="kw">arrange</span>(primaryPolls, state, pollster_id)</span></code></pre></div>
<pre><code>## # A tibble: 16,661 x 33
##    question_id poll_id cycle state pollster_id pollster sponsor_ids sponsors
##          &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;   
##  1       99478   58691  2020 Alab~        1193 SurveyM~         132 NBC News
##  2       99478   58691  2020 Alab~        1193 SurveyM~         132 NBC News
##  3       99478   58691  2020 Alab~        1193 SurveyM~         132 NBC News
##  4       99478   58691  2020 Alab~        1193 SurveyM~         132 NBC News
##  5       99478   58691  2020 Alab~        1193 SurveyM~         132 NBC News
##  6       99478   58691  2020 Alab~        1193 SurveyM~         132 NBC News
##  7       99478   58691  2020 Alab~        1193 SurveyM~         132 NBC News
##  8       99478   58691  2020 Alab~        1193 SurveyM~         132 NBC News
##  9       99478   58691  2020 Alab~        1193 SurveyM~         132 NBC News
## 10       99478   58691  2020 Alab~        1193 SurveyM~         132 NBC News
## # ... with 16,651 more rows, and 25 more variables: display_name &lt;chr&gt;,
## #   pollster_rating_id &lt;dbl&gt;, pollster_rating_name &lt;chr&gt;, fte_grade &lt;chr&gt;,
## #   sample_size &lt;dbl&gt;, population &lt;chr&gt;, population_full &lt;chr&gt;,
## #   methodology &lt;chr&gt;, office_type &lt;chr&gt;, start_date &lt;date&gt;, end_date &lt;chr&gt;,
## #   sponsor_candidate &lt;lgl&gt;, internal &lt;lgl&gt;, partisan &lt;lgl&gt;, tracking &lt;lgl&gt;,
## #   nationwide_batch &lt;lgl&gt;, created_at &lt;chr&gt;, notes &lt;chr&gt;, url &lt;chr&gt;,
## #   stage &lt;chr&gt;, party &lt;chr&gt;, answer &lt;chr&gt;, candidate_id &lt;dbl&gt;,
## #   candidate_name &lt;chr&gt;, pct &lt;dbl&gt;</code></pre>
<ul>
<li>Or in descending order</li>
</ul>
<div class="sourceCode" id="section-cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb514-1"><a href="section-dplyr-and-tidy.html#section-cb514-1"></a><span class="kw">arrange</span>(primaryPolls, state, <span class="kw">desc</span>(pollster_id))</span></code></pre></div>
<pre><code>## # A tibble: 16,661 x 33
##    question_id poll_id cycle state pollster_id pollster sponsor_ids sponsors
##          &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;   
##  1       93812   57768  2020 Alab~        1365 Change ~          NA &lt;NA&gt;    
##  2       93812   57768  2020 Alab~        1365 Change ~          NA &lt;NA&gt;    
##  3       93812   57768  2020 Alab~        1365 Change ~          NA &lt;NA&gt;    
##  4       93812   57768  2020 Alab~        1365 Change ~          NA &lt;NA&gt;    
##  5       93812   57768  2020 Alab~        1365 Change ~          NA &lt;NA&gt;    
##  6       93812   57768  2020 Alab~        1365 Change ~          NA &lt;NA&gt;    
##  7       93812   57768  2020 Alab~        1365 Change ~          NA &lt;NA&gt;    
##  8       93812   57768  2020 Alab~        1365 Change ~          NA &lt;NA&gt;    
##  9       93812   57768  2020 Alab~        1365 Change ~          NA &lt;NA&gt;    
## 10       93812   57768  2020 Alab~        1365 Change ~          NA &lt;NA&gt;    
## # ... with 16,651 more rows, and 25 more variables: display_name &lt;chr&gt;,
## #   pollster_rating_id &lt;dbl&gt;, pollster_rating_name &lt;chr&gt;, fte_grade &lt;chr&gt;,
## #   sample_size &lt;dbl&gt;, population &lt;chr&gt;, population_full &lt;chr&gt;,
## #   methodology &lt;chr&gt;, office_type &lt;chr&gt;, start_date &lt;date&gt;, end_date &lt;chr&gt;,
## #   sponsor_candidate &lt;lgl&gt;, internal &lt;lgl&gt;, partisan &lt;lgl&gt;, tracking &lt;lgl&gt;,
## #   nationwide_batch &lt;lgl&gt;, created_at &lt;chr&gt;, notes &lt;chr&gt;, url &lt;chr&gt;,
## #   stage &lt;chr&gt;, party &lt;chr&gt;, answer &lt;chr&gt;, candidate_id &lt;dbl&gt;,
## #   candidate_name &lt;chr&gt;, pct &lt;dbl&gt;</code></pre>
</div>
<div id="section-select" class="section level3" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> <code>select</code></h3>
<ul>
<li>Select is just a much easier way to subset by column</li>
</ul>
<div class="sourceCode" id="section-cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb516-1"><a href="section-dplyr-and-tidy.html#section-cb516-1"></a><span class="kw">select</span>(primaryPolls, state, candidate_name, start_date)</span></code></pre></div>
<pre><code>## # A tibble: 16,661 x 3
##    state         candidate_name      start_date
##    &lt;chr&gt;         &lt;chr&gt;               &lt;date&gt;    
##  1 New Hampshire Bernard Sanders     2020-02-07
##  2 New Hampshire Andrew Yang         2020-02-07
##  3 New Hampshire Pete Buttigieg      2020-02-07
##  4 New Hampshire Joseph R. Biden Jr. 2020-02-07
##  5 New Hampshire Tulsi Gabbard       2020-02-07
##  6 New Hampshire Amy Klobuchar       2020-02-07
##  7 New Hampshire Elizabeth Warren    2020-02-07
##  8 New Hampshire Tom Steyer          2020-02-07
##  9 &lt;NA&gt;          Bernard Sanders     2020-02-06
## 10 &lt;NA&gt;          Joseph R. Biden Jr. 2020-02-06
## # ... with 16,651 more rows</code></pre>
<ul>
<li>It comes with a nice syntax for doing this without just listing</li>
<li><code>var1:var20</code> will select all columns between these two</li>
<li><code>-var1:var20</code> will select everything <em>except</em> that range</li>
<li><code>starts_with("cand")</code> will select columns that start with “cand”</li>
<li>Similar functionality for <code>ends_with</code>, <code>contains</code>, and matches</li>
</ul>
<p>A fun trick to move your favorite variables to the front, but keep it all:</p>
<div class="sourceCode" id="section-cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb518-1"><a href="section-dplyr-and-tidy.html#section-cb518-1"></a><span class="kw">select</span>(primaryPolls, state, candidate_name, start_date, <span class="kw">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 16,661 x 33
##    state candidate_name start_date question_id poll_id cycle pollster_id
##    &lt;chr&gt; &lt;chr&gt;          &lt;date&gt;           &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;
##  1 New ~ Bernard Sande~ 2020-02-07      116805   63512  2020        1515
##  2 New ~ Andrew Yang    2020-02-07      116805   63512  2020        1515
##  3 New ~ Pete Buttigieg 2020-02-07      116805   63512  2020        1515
##  4 New ~ Joseph R. Bid~ 2020-02-07      116805   63512  2020        1515
##  5 New ~ Tulsi Gabbard  2020-02-07      116805   63512  2020        1515
##  6 New ~ Amy Klobuchar  2020-02-07      116805   63512  2020        1515
##  7 New ~ Elizabeth War~ 2020-02-07      116805   63512  2020        1515
##  8 New ~ Tom Steyer     2020-02-07      116805   63512  2020        1515
##  9 &lt;NA&gt;  Bernard Sande~ 2020-02-06      116799   63511  2020         744
## 10 &lt;NA&gt;  Joseph R. Bid~ 2020-02-06      116799   63511  2020         744
## # ... with 16,651 more rows, and 26 more variables: pollster &lt;chr&gt;,
## #   sponsor_ids &lt;dbl&gt;, sponsors &lt;chr&gt;, display_name &lt;chr&gt;,
## #   pollster_rating_id &lt;dbl&gt;, pollster_rating_name &lt;chr&gt;, fte_grade &lt;chr&gt;,
## #   sample_size &lt;dbl&gt;, population &lt;chr&gt;, population_full &lt;chr&gt;,
## #   methodology &lt;chr&gt;, office_type &lt;chr&gt;, end_date &lt;chr&gt;,
## #   sponsor_candidate &lt;lgl&gt;, internal &lt;lgl&gt;, partisan &lt;lgl&gt;, tracking &lt;lgl&gt;,
## #   nationwide_batch &lt;lgl&gt;, created_at &lt;chr&gt;, notes &lt;chr&gt;, url &lt;chr&gt;,
## #   stage &lt;chr&gt;, party &lt;chr&gt;, answer &lt;chr&gt;, candidate_id &lt;dbl&gt;, pct &lt;dbl&gt;</code></pre>
<ul>
<li>Note here that <code>rename</code> is the mythical easy way to rename a column, although syntax seems backwards</li>
<li>You have to specify the new column name on the left side of the equal sign and the old column name on the right</li>
</ul>
<div class="sourceCode" id="section-cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb520-1"><a href="section-dplyr-and-tidy.html#section-cb520-1"></a>basicPolls&lt;-<span class="kw">select</span>(primaryPolls, state, candidate_name, start_date, pct)</span>
<span id="section-cb520-2"><a href="section-dplyr-and-tidy.html#section-cb520-2"></a><span class="kw">rename</span>(basicPolls, <span class="dt">candidate =</span> candidate_name)</span></code></pre></div>
<pre><code>## # A tibble: 16,661 x 4
##    state         candidate           start_date   pct
##    &lt;chr&gt;         &lt;chr&gt;               &lt;date&gt;     &lt;dbl&gt;
##  1 New Hampshire Bernard Sanders     2020-02-07    28
##  2 New Hampshire Andrew Yang         2020-02-07     5
##  3 New Hampshire Pete Buttigieg      2020-02-07    26
##  4 New Hampshire Joseph R. Biden Jr. 2020-02-07     9
##  5 New Hampshire Tulsi Gabbard       2020-02-07     3
##  6 New Hampshire Amy Klobuchar       2020-02-07    13
##  7 New Hampshire Elizabeth Warren    2020-02-07    14
##  8 New Hampshire Tom Steyer          2020-02-07     3
##  9 &lt;NA&gt;          Bernard Sanders     2020-02-06    20
## 10 &lt;NA&gt;          Joseph R. Biden Jr. 2020-02-06    17
## # ... with 16,651 more rows</code></pre>
</div>
<div id="section-mutate" class="section level3" number="7.2.4">
<h3><span class="header-section-number">7.2.4</span> <code>mutate</code></h3>
<ul>
<li><code>mutate</code> allows us to create a new variable that is a function of the others</li>
<li>If you want to add the new column(s) to your existing tibble, you must use the assignment operator.
<ul>
<li>Otherwise it will just print it out and throw the results away</li>
</ul></li>
</ul>
<div class="sourceCode" id="section-cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb522-1"><a href="section-dplyr-and-tidy.html#section-cb522-1"></a><span class="kw">mutate</span>(basicPolls, <span class="dt">proportion=</span>pct<span class="op">/</span><span class="dv">100</span>)</span></code></pre></div>
<pre><code>## # A tibble: 16,661 x 5
##    state         candidate_name      start_date   pct proportion
##    &lt;chr&gt;         &lt;chr&gt;               &lt;date&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1 New Hampshire Bernard Sanders     2020-02-07    28       0.28
##  2 New Hampshire Andrew Yang         2020-02-07     5       0.05
##  3 New Hampshire Pete Buttigieg      2020-02-07    26       0.26
##  4 New Hampshire Joseph R. Biden Jr. 2020-02-07     9       0.09
##  5 New Hampshire Tulsi Gabbard       2020-02-07     3       0.03
##  6 New Hampshire Amy Klobuchar       2020-02-07    13       0.13
##  7 New Hampshire Elizabeth Warren    2020-02-07    14       0.14
##  8 New Hampshire Tom Steyer          2020-02-07     3       0.03
##  9 &lt;NA&gt;          Bernard Sanders     2020-02-06    20       0.2 
## 10 &lt;NA&gt;          Joseph R. Biden Jr. 2020-02-06    17       0.17
## # ... with 16,651 more rows</code></pre>
<div class="sourceCode" id="section-cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb524-1"><a href="section-dplyr-and-tidy.html#section-cb524-1"></a>basicPolls &lt;-<span class="st"> </span><span class="kw">mutate</span>(basicPolls, <span class="dt">proportion=</span>pct<span class="op">/</span><span class="dv">100</span>)</span></code></pre></div>
<ul>
<li>transmute creates and returns a new tibble with only the mutated variable(s)</li>
</ul>
<div class="sourceCode" id="section-cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb525-1"><a href="section-dplyr-and-tidy.html#section-cb525-1"></a><span class="kw">transmute</span>(basicPolls, <span class="dt">proportion=</span>pct<span class="op">/</span><span class="dv">100</span>)</span></code></pre></div>
<pre><code>## # A tibble: 16,661 x 1
##    proportion
##         &lt;dbl&gt;
##  1       0.28
##  2       0.05
##  3       0.26
##  4       0.09
##  5       0.03
##  6       0.13
##  7       0.14
##  8       0.03
##  9       0.2 
## 10       0.17
## # ... with 16,651 more rows</code></pre>
<div class="sourceCode" id="section-cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb527-1"><a href="section-dplyr-and-tidy.html#section-cb527-1"></a><span class="kw">transmute</span>(primaryPolls, <span class="dt">numberRespondents=</span><span class="kw">round</span>((pct<span class="op">/</span><span class="dv">100</span>)<span class="op">*</span>sample_size))</span></code></pre></div>
<pre><code>## # A tibble: 16,661 x 1
##    numberRespondents
##                &lt;dbl&gt;
##  1               363
##  2                65
##  3               337
##  4               117
##  5                39
##  6               168
##  7               181
##  8                39
##  9               111
## 10                95
## # ... with 16,651 more rows</code></pre>
<div class="sourceCode" id="section-cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb529-1"><a href="section-dplyr-and-tidy.html#section-cb529-1"></a><span class="kw">transmute</span>(primaryPolls, </span>
<span id="section-cb529-2"><a href="section-dplyr-and-tidy.html#section-cb529-2"></a>          <span class="dt">proportion=</span>pct<span class="op">/</span><span class="dv">100</span>,</span>
<span id="section-cb529-3"><a href="section-dplyr-and-tidy.html#section-cb529-3"></a>          <span class="dt">numberRespondents=</span><span class="kw">round</span>(proportion<span class="op">*</span>sample_size),</span>
<span id="section-cb529-4"><a href="section-dplyr-and-tidy.html#section-cb529-4"></a>          )</span></code></pre></div>
<pre><code>## # A tibble: 16,661 x 2
##    proportion numberRespondents
##         &lt;dbl&gt;             &lt;dbl&gt;
##  1       0.28               363
##  2       0.05                65
##  3       0.26               337
##  4       0.09               117
##  5       0.03                39
##  6       0.13               168
##  7       0.14               181
##  8       0.03                39
##  9       0.2                111
## 10       0.17                95
## # ... with 16,651 more rows</code></pre>
<ul>
<li>Note that you can use a ton of the basic functions we have already covered like <code>sum</code>, <code>mean</code>, <code>sqrt</code>, etc.</li>
<li>A useful one is <code>n()</code>, which just counts the number of observations</li>
<li>This includes logical comparisons</li>
</ul>
<div class="sourceCode" id="section-cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb531-1"><a href="section-dplyr-and-tidy.html#section-cb531-1"></a><span class="kw">mutate</span>(basicPolls, <span class="dt">top_tier=</span>(pct<span class="op">&gt;</span><span class="dv">10</span>)<span class="op">*</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 16,661 x 6
##    state         candidate_name      start_date   pct proportion top_tier
##    &lt;chr&gt;         &lt;chr&gt;               &lt;date&gt;     &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
##  1 New Hampshire Bernard Sanders     2020-02-07    28       0.28        1
##  2 New Hampshire Andrew Yang         2020-02-07     5       0.05        0
##  3 New Hampshire Pete Buttigieg      2020-02-07    26       0.26        1
##  4 New Hampshire Joseph R. Biden Jr. 2020-02-07     9       0.09        0
##  5 New Hampshire Tulsi Gabbard       2020-02-07     3       0.03        0
##  6 New Hampshire Amy Klobuchar       2020-02-07    13       0.13        1
##  7 New Hampshire Elizabeth Warren    2020-02-07    14       0.14        1
##  8 New Hampshire Tom Steyer          2020-02-07     3       0.03        0
##  9 &lt;NA&gt;          Bernard Sanders     2020-02-06    20       0.2         1
## 10 &lt;NA&gt;          Joseph R. Biden Jr. 2020-02-06    17       0.17        1
## # ... with 16,651 more rows</code></pre>
</div>
<div id="section-summarise" class="section level3" number="7.2.5">
<h3><span class="header-section-number">7.2.5</span> <code>summarise</code></h3>
<ul>
<li>We can easily extract summary statistics</li>
</ul>
<div class="sourceCode" id="section-cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb533-1"><a href="section-dplyr-and-tidy.html#section-cb533-1"></a><span class="kw">summarise</span>(basicPolls, <span class="dt">average_candidate=</span><span class="kw">mean</span>(pct), <span class="dt">count=</span><span class="kw">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   average_candidate count
##               &lt;dbl&gt; &lt;int&gt;
## 1              6.34 16661</code></pre>
<ul>
<li>This is more powerful when also using the <code>group_by</code> function</li>
</ul>
<div class="sourceCode" id="section-cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb535-1"><a href="section-dplyr-and-tidy.html#section-cb535-1"></a>basicPolls_grouped&lt;-<span class="kw">group_by</span>(basicPolls, candidate_name)</span>
<span id="section-cb535-2"><a href="section-dplyr-and-tidy.html#section-cb535-2"></a><span class="kw">summarise</span>(basicPolls_grouped, <span class="dt">average_candidate=</span><span class="kw">mean</span>(pct), <span class="dt">count=</span><span class="kw">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 76 x 3
##    candidate_name   average_candidate count
##    &lt;chr&gt;                        &lt;dbl&gt; &lt;int&gt;
##  1 Amy Klobuchar                2.32    874
##  2 Andrew Cuomo                 0.433    12
##  3 Andrew Yang                  2.34    831
##  4 Barack Obama                 0         2
##  5 Ben Sasse                    0.711    36
##  6 Bernard Sanders             18.3     960
##  7 Beto O&#39;Rourke                3.76    653
##  8 Bill de Blasio               0.534   318
##  9 Bob Corker                   0.611    36
## 10 Charles D. Baker            31.5       2
## # ... with 66 more rows</code></pre>
<div class="sourceCode" id="section-cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb537-1"><a href="section-dplyr-and-tidy.html#section-cb537-1"></a>basicPolls_grouped&lt;-<span class="kw">group_by</span>(basicPolls, candidate_name, state)</span>
<span id="section-cb537-2"><a href="section-dplyr-and-tidy.html#section-cb537-2"></a><span class="kw">summarise</span>(basicPolls_grouped, <span class="dt">average_candidate=</span><span class="kw">mean</span>(pct), <span class="dt">count=</span><span class="kw">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1,024 x 4
## # Groups:   candidate_name [76]
##    candidate_name state      average_candidate count
##    &lt;chr&gt;          &lt;chr&gt;                  &lt;dbl&gt; &lt;int&gt;
##  1 Amy Klobuchar  Alabama                 1        3
##  2 Amy Klobuchar  Arizona                 1.18     6
##  3 Amy Klobuchar  California              1.74    40
##  4 Amy Klobuchar  Colorado                0.1      1
##  5 Amy Klobuchar  Delaware                1        1
##  6 Amy Klobuchar  Florida                 1.98    13
##  7 Amy Klobuchar  Georgia                 1.27     4
##  8 Amy Klobuchar  Illinois                2.15     2
##  9 Amy Klobuchar  Indiana                 0        1
## 10 Amy Klobuchar  Iowa                    5.97    61
## # ... with 1,014 more rows</code></pre>
</div>
<div id="section-piping" class="section level3" number="7.2.6">
<h3><span class="header-section-number">7.2.6</span> Piping</h3>
<ul>
<li>The tidyverse includes a nice syntax for combining multiple commands so we don’t have to create new objects all of the time.</li>
<li>The <code>%?%</code> syntax allows us to pass on the results of one line to another</li>
<li>The result from the left side of the <code>%&gt;%</code> is passed as the first parameter of the next function</li>
</ul>
<div class="sourceCode" id="section-cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb539-1"><a href="section-dplyr-and-tidy.html#section-cb539-1"></a>basicPolls <span class="op">%&gt;%</span></span>
<span id="section-cb539-2"><a href="section-dplyr-and-tidy.html#section-cb539-2"></a><span class="st">  </span><span class="kw">group_by</span>(candidate_name, state) <span class="op">%&gt;%</span></span>
<span id="section-cb539-3"><a href="section-dplyr-and-tidy.html#section-cb539-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">average_candidate=</span><span class="kw">mean</span>(pct), <span class="dt">count=</span><span class="kw">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1,024 x 4
## # Groups:   candidate_name [76]
##    candidate_name state      average_candidate count
##    &lt;chr&gt;          &lt;chr&gt;                  &lt;dbl&gt; &lt;int&gt;
##  1 Amy Klobuchar  Alabama                 1        3
##  2 Amy Klobuchar  Arizona                 1.18     6
##  3 Amy Klobuchar  California              1.74    40
##  4 Amy Klobuchar  Colorado                0.1      1
##  5 Amy Klobuchar  Delaware                1        1
##  6 Amy Klobuchar  Florida                 1.98    13
##  7 Amy Klobuchar  Georgia                 1.27     4
##  8 Amy Klobuchar  Illinois                2.15     2
##  9 Amy Klobuchar  Indiana                 0        1
## 10 Amy Klobuchar  Iowa                    5.97    61
## # ... with 1,014 more rows</code></pre>
<ul>
<li>The above code is equivalent to the following:</li>
</ul>
<div class="sourceCode" id="section-cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb541-1"><a href="section-dplyr-and-tidy.html#section-cb541-1"></a><span class="kw">summarise</span>(<span class="kw">group_by</span>(basicPolls, candidate_name, state), <span class="dt">average_candidate=</span><span class="kw">mean</span>(pct), <span class="dt">count=</span><span class="kw">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1,024 x 4
## # Groups:   candidate_name [76]
##    candidate_name state      average_candidate count
##    &lt;chr&gt;          &lt;chr&gt;                  &lt;dbl&gt; &lt;int&gt;
##  1 Amy Klobuchar  Alabama                 1        3
##  2 Amy Klobuchar  Arizona                 1.18     6
##  3 Amy Klobuchar  California              1.74    40
##  4 Amy Klobuchar  Colorado                0.1      1
##  5 Amy Klobuchar  Delaware                1        1
##  6 Amy Klobuchar  Florida                 1.98    13
##  7 Amy Klobuchar  Georgia                 1.27     4
##  8 Amy Klobuchar  Illinois                2.15     2
##  9 Amy Klobuchar  Indiana                 0        1
## 10 Amy Klobuchar  Iowa                    5.97    61
## # ... with 1,014 more rows</code></pre>
<ul>
<li>Which is equivalent to this:</li>
</ul>
<div class="sourceCode" id="section-cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb543-1"><a href="section-dplyr-and-tidy.html#section-cb543-1"></a>grouped_by &lt;-<span class="st"> </span><span class="kw">group_by</span>(basicPolls, candidate_name, state)</span>
<span id="section-cb543-2"><a href="section-dplyr-and-tidy.html#section-cb543-2"></a><span class="kw">summarise</span>(grouped_by, <span class="dt">average_candidate=</span><span class="kw">mean</span>(pct), <span class="dt">count=</span><span class="kw">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1,024 x 4
## # Groups:   candidate_name [76]
##    candidate_name state      average_candidate count
##    &lt;chr&gt;          &lt;chr&gt;                  &lt;dbl&gt; &lt;int&gt;
##  1 Amy Klobuchar  Alabama                 1        3
##  2 Amy Klobuchar  Arizona                 1.18     6
##  3 Amy Klobuchar  California              1.74    40
##  4 Amy Klobuchar  Colorado                0.1      1
##  5 Amy Klobuchar  Delaware                1        1
##  6 Amy Klobuchar  Florida                 1.98    13
##  7 Amy Klobuchar  Georgia                 1.27     4
##  8 Amy Klobuchar  Illinois                2.15     2
##  9 Amy Klobuchar  Indiana                 0        1
## 10 Amy Klobuchar  Iowa                    5.97    61
## # ... with 1,014 more rows</code></pre>
<ul>
<li>See assigned readings for more useful summary variables and <code>ungroup</code></li>
</ul>
<div class="sourceCode" id="section-cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb545-1"><a href="section-dplyr-and-tidy.html#section-cb545-1"></a>basicPolls <span class="op">%&gt;%</span></span>
<span id="section-cb545-2"><a href="section-dplyr-and-tidy.html#section-cb545-2"></a><span class="st">  </span><span class="kw">group_by</span>(candidate_name, state) <span class="op">%&gt;%</span></span>
<span id="section-cb545-3"><a href="section-dplyr-and-tidy.html#section-cb545-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">average_candidate=</span><span class="kw">mean</span>(pct), <span class="dt">count=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span></span>
<span id="section-cb545-4"><a href="section-dplyr-and-tidy.html#section-cb545-4"></a><span class="st">  </span><span class="kw">filter</span>(count<span class="op">&gt;</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 206 x 4
## # Groups:   candidate_name [44]
##    candidate_name state          average_candidate count
##    &lt;chr&gt;          &lt;chr&gt;                      &lt;dbl&gt; &lt;int&gt;
##  1 Amy Klobuchar  California                  1.74    40
##  2 Amy Klobuchar  Florida                     1.98    13
##  3 Amy Klobuchar  Iowa                        5.97    61
##  4 Amy Klobuchar  Nevada                      1.71    15
##  5 Amy Klobuchar  New Hampshire               5.42    84
##  6 Amy Klobuchar  Pennsylvania                1.53    11
##  7 Amy Klobuchar  South Carolina              1.27    34
##  8 Amy Klobuchar  Texas                       1.47    23
##  9 Amy Klobuchar  Wisconsin                   2.52    16
## 10 Amy Klobuchar  &lt;NA&gt;                        1.62   503
## # ... with 196 more rows</code></pre>
<div class="sourceCode" id="section-cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb547-1"><a href="section-dplyr-and-tidy.html#section-cb547-1"></a>primaryPolls <span class="op">%&gt;%</span></span>
<span id="section-cb547-2"><a href="section-dplyr-and-tidy.html#section-cb547-2"></a><span class="st">  </span><span class="kw">group_by</span>(candidate_name, state) <span class="op">%&gt;%</span></span>
<span id="section-cb547-3"><a href="section-dplyr-and-tidy.html#section-cb547-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">average_candidate=</span><span class="kw">mean</span>(pct), <span class="dt">count=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span></span>
<span id="section-cb547-4"><a href="section-dplyr-and-tidy.html#section-cb547-4"></a><span class="st">  </span><span class="kw">filter</span>(count<span class="op">&gt;</span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="section-cb547-5"><a href="section-dplyr-and-tidy.html#section-cb547-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">average_prop=</span>average_candidate<span class="op">/</span><span class="dv">100</span>) <span class="op">%&gt;%</span></span>
<span id="section-cb547-6"><a href="section-dplyr-and-tidy.html#section-cb547-6"></a><span class="st">  </span><span class="kw">select</span>(average_prop, candidate_name, state, count)</span></code></pre></div>
<pre><code>## # A tibble: 206 x 4
## # Groups:   candidate_name [44]
##    average_prop candidate_name state          count
##           &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;          &lt;int&gt;
##  1       0.0174 Amy Klobuchar  California        40
##  2       0.0198 Amy Klobuchar  Florida           13
##  3       0.0597 Amy Klobuchar  Iowa              61
##  4       0.0171 Amy Klobuchar  Nevada            15
##  5       0.0542 Amy Klobuchar  New Hampshire     84
##  6       0.0153 Amy Klobuchar  Pennsylvania      11
##  7       0.0127 Amy Klobuchar  South Carolina    34
##  8       0.0147 Amy Klobuchar  Texas             23
##  9       0.0252 Amy Klobuchar  Wisconsin         16
## 10       0.0162 Amy Klobuchar  &lt;NA&gt;             503
## # ... with 196 more rows</code></pre>
</div>
<div id="section-pivots" class="section level3" number="7.2.7">
<h3><span class="header-section-number">7.2.7</span> Pivots</h3>
<ul>
<li><p>In many cases the data is not quite organized the way we want.</p></li>
<li><p>Right now we have each poll as a separate row. But what if we want each candidate to be a row so we can analyze their trends in polls over time?</p></li>
<li><p>Or what if we get the trend line and want to instead reorganize to look at each poll separately?</p></li>
<li><p>The key commands here are <code>pivot_wider</code> and <code>pivot_longer</code></p></li>
<li><p>See Chapter 12 for some additional (but less universally useful functions)</p></li>
<li><p>In our running example we have one entry for each poll. How could we combine these to list the result from each unique poll togehter?</p></li>
<li><p>The key here is that the <em>values</em> of interest are in the <code>pct</code> column and the <em>groupings</em> of interest are in the candidates column</p></li>
</ul>
<div class="sourceCode" id="section-cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb549-1"><a href="section-dplyr-and-tidy.html#section-cb549-1"></a>nevadaPrimaries&lt;-primaryPolls <span class="op">%&gt;%</span></span>
<span id="section-cb549-2"><a href="section-dplyr-and-tidy.html#section-cb549-2"></a><span class="st"> </span><span class="kw">filter</span>(candidate_name <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Amy Klobuchar&quot;</span>, <span class="st">&quot;Bernard Sanders&quot;</span>, <span class="st">&quot;Elizabeth Warren&quot;</span>, <span class="st">&quot;Joseph R. Biden Jr.&quot;</span>, <span class="st">&quot;Michael Bloomberg&quot;</span>, <span class="st">&quot;Pete Buttigieg&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="section-cb549-3"><a href="section-dplyr-and-tidy.html#section-cb549-3"></a><span class="st">  </span><span class="kw">filter</span>(state<span class="op">==</span><span class="st">&quot;Nevada&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="section-cb549-4"><a href="section-dplyr-and-tidy.html#section-cb549-4"></a><span class="st">  </span><span class="kw">select</span>(candidate_name, pct, start_date, sample_size)</span>
<span id="section-cb549-5"><a href="section-dplyr-and-tidy.html#section-cb549-5"></a><span class="kw">print</span>(nevadaPrimaries, <span class="dt">n=</span><span class="ot">Inf</span>)</span></code></pre></div>
<pre><code>## # A tibble: 76 x 4
##    candidate_name        pct start_date sample_size
##    &lt;chr&gt;               &lt;dbl&gt; &lt;date&gt;           &lt;dbl&gt;
##  1 Joseph R. Biden Jr.  19.4 2020-01-08         500
##  2 Bernard Sanders      17.6 2020-01-08         500
##  3 Elizabeth Warren     10.6 2020-01-08         500
##  4 Pete Buttigieg        8.2 2020-01-08         500
##  5 Amy Klobuchar         3.6 2020-01-08         500
##  6 Elizabeth Warren     14   2020-01-06         600
##  7 Bernard Sanders      29   2020-01-06         600
##  8 Joseph R. Biden Jr.  28   2020-01-06         600
##  9 Pete Buttigieg        6   2020-01-06         600
## 10 Amy Klobuchar         4   2020-01-06         600
## 11 Joseph R. Biden Jr.  23   2020-01-05         635
## 12 Bernard Sanders      17   2020-01-05         635
## 13 Elizabeth Warren     12   2020-01-05         635
## 14 Pete Buttigieg        6   2020-01-05         635
## 15 Michael Bloomberg     2   2020-01-05         635
## 16 Amy Klobuchar         2   2020-01-05         635
## 17 Joseph R. Biden Jr.  24   2019-11-10         627
## 18 Bernard Sanders      18   2019-11-10         627
## 19 Elizabeth Warren     18   2019-11-10         627
## 20 Pete Buttigieg        8   2019-11-10         627
## 21 Amy Klobuchar         2   2019-11-10         627
## 22 Joseph R. Biden Jr.  33   2019-11-06         626
## 23 Bernard Sanders      23   2019-11-06         626
## 24 Elizabeth Warren     21   2019-11-06         626
## 25 Pete Buttigieg        9   2019-11-06         626
## 26 Amy Klobuchar         2   2019-11-06         626
## 27 Joseph R. Biden Jr.  29.9 2019-10-31         451
## 28 Bernard Sanders      18.8 2019-10-31         451
## 29 Elizabeth Warren     22.2 2019-10-31         451
## 30 Pete Buttigieg        4.9 2019-10-31         451
## 31 Amy Klobuchar         0.7 2019-10-31         451
## 32 Joseph R. Biden Jr.  29.1 2019-10-28         600
## 33 Pete Buttigieg        7.3 2019-10-28         600
## 34 Amy Klobuchar         2.5 2019-10-28         600
## 35 Bernard Sanders      19.1 2019-10-28         600
## 36 Elizabeth Warren     19.2 2019-10-28         600
## 37 Joseph R. Biden Jr.  22   2019-09-22         324
## 38 Bernard Sanders      22   2019-09-22         324
## 39 Elizabeth Warren     18   2019-09-22         324
## 40 Pete Buttigieg        4   2019-09-22         324
## 41 Amy Klobuchar         1   2019-09-22         324
## 42 Joseph R. Biden Jr.  23.2 2019-09-19         500
## 43 Pete Buttigieg        3.4 2019-09-19         500
## 44 Amy Klobuchar         0.4 2019-09-19         500
## 45 Bernard Sanders      14.2 2019-09-19         500
## 46 Elizabeth Warren     19.4 2019-09-19         500
## 47 Bernard Sanders      29   2019-08-28         563
## 48 Joseph R. Biden Jr.  27   2019-08-28         563
## 49 Elizabeth Warren     18   2019-08-28         563
## 50 Pete Buttigieg        4   2019-08-28         563
## 51 Amy Klobuchar         0   2019-08-28         563
## 52 Joseph R. Biden Jr.  25   2019-08-14         382
## 53 Elizabeth Warren     15   2019-08-14         382
## 54 Bernard Sanders      10   2019-08-14         382
## 55 Pete Buttigieg        5   2019-08-14         382
## 56 Amy Klobuchar         2   2019-08-14         382
## 57 Joseph R. Biden Jr.  26   2019-08-02         439
## 58 Elizabeth Warren     23   2019-08-02         439
## 59 Bernard Sanders      22   2019-08-02         439
## 60 Pete Buttigieg        7   2019-08-02         439
## 61 Amy Klobuchar         1   2019-08-02         439
## 62 Joseph R. Biden Jr.  36   2019-06-06         370
## 63 Elizabeth Warren     19   2019-06-06         370
## 64 Bernard Sanders      13   2019-06-06         370
## 65 Pete Buttigieg        7   2019-06-06         370
## 66 Amy Klobuchar         1   2019-06-06         370
## 67 Joseph R. Biden Jr.  29   2019-05-09         389
## 68 Bernard Sanders      24   2019-05-09         389
## 69 Pete Buttigieg       13   2019-05-09         389
## 70 Elizabeth Warren     12   2019-05-09         389
## 71 Amy Klobuchar         1   2019-05-09         389
## 72 Elizabeth Warren      9.9 2019-03-28         310
## 73 Pete Buttigieg        4.7 2019-03-28         310
## 74 Joseph R. Biden Jr.  26.4 2019-03-28         310
## 75 Bernard Sanders      22.5 2019-03-28         310
## 76 Amy Klobuchar         2.4 2019-03-28         310</code></pre>
<ul>
<li>setting <code>n=Inf</code> in the print will ensure that all rows are shown (the equivalent for columns is <code>width=Inf</code>)</li>
<li><code>nevadaPrimaries</code> contains one row for every combination of a Nevada poll (specified by <code>start_date</code> and <code>sample_size</code>) and a candidate</li>
</ul>
<div class="sourceCode" id="section-cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb551-1"><a href="section-dplyr-and-tidy.html#section-cb551-1"></a>wideNevada&lt;-<span class="kw">pivot_wider</span>(nevadaPrimaries, <span class="dt">names_from =</span> candidate_name, <span class="dt">values_from =</span> pct)</span>
<span id="section-cb551-2"><a href="section-dplyr-and-tidy.html#section-cb551-2"></a><span class="kw">print</span>(wideNevada, <span class="dt">width=</span><span class="ot">Inf</span>)</span></code></pre></div>
<pre><code>## # A tibble: 15 x 8
##    start_date sample_size `Joseph R. Biden Jr.` `Bernard Sanders`
##    &lt;date&gt;           &lt;dbl&gt;                 &lt;dbl&gt;             &lt;dbl&gt;
##  1 2020-01-08         500                  19.4              17.6
##  2 2020-01-06         600                  28                29  
##  3 2020-01-05         635                  23                17  
##  4 2019-11-10         627                  24                18  
##  5 2019-11-06         626                  33                23  
##  6 2019-10-31         451                  29.9              18.8
##  7 2019-10-28         600                  29.1              19.1
##  8 2019-09-22         324                  22                22  
##  9 2019-09-19         500                  23.2              14.2
## 10 2019-08-28         563                  27                29  
## 11 2019-08-14         382                  25                10  
## 12 2019-08-02         439                  26                22  
## 13 2019-06-06         370                  36                13  
## 14 2019-05-09         389                  29                24  
## 15 2019-03-28         310                  26.4              22.5
##    `Elizabeth Warren` `Pete Buttigieg` `Amy Klobuchar` `Michael Bloomberg`
##                 &lt;dbl&gt;            &lt;dbl&gt;           &lt;dbl&gt;               &lt;dbl&gt;
##  1               10.6              8.2             3.6                  NA
##  2               14                6               4                    NA
##  3               12                6               2                     2
##  4               18                8               2                    NA
##  5               21                9               2                    NA
##  6               22.2              4.9             0.7                  NA
##  7               19.2              7.3             2.5                  NA
##  8               18                4               1                    NA
##  9               19.4              3.4             0.4                  NA
## 10               18                4               0                    NA
## 11               15                5               2                    NA
## 12               23                7               1                    NA
## 13               19                7               1                    NA
## 14               12               13               1                    NA
## 15                9.9              4.7             2.4                  NA</code></pre>
<ul>
<li><code>wideNevada</code> contains one row for every Nevada poll and a column for the pct each candidate got</li>
</ul>
<div class="sourceCode" id="section-cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb553-1"><a href="section-dplyr-and-tidy.html#section-cb553-1"></a><span class="kw">dim</span>(nevadaPrimaries)</span></code></pre></div>
<pre><code>## [1] 76  4</code></pre>
<div class="sourceCode" id="section-cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb555-1"><a href="section-dplyr-and-tidy.html#section-cb555-1"></a><span class="kw">dim</span>(wideNevada)</span></code></pre></div>
<pre><code>## [1] 15  8</code></pre>
<ul>
<li>Or we could organize it into a time series ….</li>
</ul>
<div class="sourceCode" id="section-cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb557-1"><a href="section-dplyr-and-tidy.html#section-cb557-1"></a>timeNevada&lt;-<span class="kw">pivot_wider</span>(nevadaPrimaries, <span class="dt">id_cols=</span>candidate_name, </span>
<span id="section-cb557-2"><a href="section-dplyr-and-tidy.html#section-cb557-2"></a>                        <span class="dt">names_from =</span> <span class="kw">c</span>(start_date), <span class="dt">values_from =</span> pct)</span>
<span id="section-cb557-3"><a href="section-dplyr-and-tidy.html#section-cb557-3"></a><span class="kw">print</span>(timeNevada, <span class="dt">width=</span><span class="ot">Inf</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 16
##   candidate_name      `2020-01-08` `2020-01-06` `2020-01-05` `2019-11-10`
##   &lt;chr&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1 Joseph R. Biden Jr.         19.4           28           23           24
## 2 Bernard Sanders             17.6           29           17           18
## 3 Elizabeth Warren            10.6           14           12           18
## 4 Pete Buttigieg               8.2            6            6            8
## 5 Amy Klobuchar                3.6            4            2            2
## 6 Michael Bloomberg           NA             NA            2           NA
##   `2019-11-06` `2019-10-31` `2019-10-28` `2019-09-22` `2019-09-19` `2019-08-28`
##          &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1           33         29.9         29.1           22         23.2           27
## 2           23         18.8         19.1           22         14.2           29
## 3           21         22.2         19.2           18         19.4           18
## 4            9          4.9          7.3            4          3.4            4
## 5            2          0.7          2.5            1          0.4            0
## 6           NA         NA           NA             NA         NA             NA
##   `2019-08-14` `2019-08-02` `2019-06-06` `2019-05-09` `2019-03-28`
##          &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1           25           26           36           29         26.4
## 2           10           22           13           24         22.5
## 3           15           23           19           12          9.9
## 4            5            7            7           13          4.7
## 5            2            1            1            1          2.4
## 6           NA           NA           NA           NA         NA</code></pre>
<ul>
<li>Of course sometimes we want to do the reverse using <code>pivot_longer</code></li>
<li>In this case, we no longer have a single indicator variable for the values of <code>start_date</code></li>
</ul>
<div class="sourceCode" id="section-cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb559-1"><a href="section-dplyr-and-tidy.html#section-cb559-1"></a>timeNevada <span class="op">%&gt;%</span></span>
<span id="section-cb559-2"><a href="section-dplyr-and-tidy.html#section-cb559-2"></a><span class="st">  </span><span class="kw">select</span>(candidate_name, <span class="st">`</span><span class="dt">2020-01-08</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2020-01-06</span><span class="st">`</span>) <span class="op">%&gt;%</span></span>
<span id="section-cb559-3"><a href="section-dplyr-and-tidy.html#section-cb559-3"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">c</span>(<span class="st">`</span><span class="dt">2020-01-08</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2020-01-06</span><span class="st">`</span>), <span class="dt">names_to =</span> <span class="st">&quot;start_date_test&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;pct_test&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 3
##    candidate_name      start_date_test pct_test
##    &lt;chr&gt;               &lt;chr&gt;              &lt;dbl&gt;
##  1 Joseph R. Biden Jr. 2020-01-08          19.4
##  2 Joseph R. Biden Jr. 2020-01-06          28  
##  3 Bernard Sanders     2020-01-08          17.6
##  4 Bernard Sanders     2020-01-06          29  
##  5 Elizabeth Warren    2020-01-08          10.6
##  6 Elizabeth Warren    2020-01-06          14  
##  7 Pete Buttigieg      2020-01-08           8.2
##  8 Pete Buttigieg      2020-01-06           6  
##  9 Amy Klobuchar       2020-01-08           3.6
## 10 Amy Klobuchar       2020-01-06           4  
## 11 Michael Bloomberg   2020-01-08          NA  
## 12 Michael Bloomberg   2020-01-06          NA</code></pre>
<ul>
<li>This will partially undo the <code>pivot_wider</code> command above</li>
<li>Now, each row is a combination of one of the six candidates and one of the two start dates</li>
<li>Note that to get this, we used <code>names_to</code> and <code>values_to</code> instead of <code>names_from</code> and <code>values_from</code></li>
</ul>
</div>
</div>
<div id="section-relational-data" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Relational data</h2>
<ul>
<li>Most complex analyses involve more than one table of data.</li>
<li>Certainly most active databases are not just rectangles.</li>
<li>Modern databases are relational, where we know how rows in each rectangle are related to each other.</li>
<li>With some slight mind bending, we can learn how to work cleanly with such data.</li>
</ul>
<p>A classic example of relational data is a social media website like Twitter. They would have multiple tables/datasets - one for each user and their
user information, one for each tweet and its author, one for each like, the user who did the like, and the tweet that was liked, etc.</p>
<p>From this data, we can use relational queries to count the average number of likes Donald Trump gets on his tweets that are tweeted between
1 and 2 AM.</p>
<p>The primary relational querying language is SQL (Structured Query Language) but most of the same techniques can be applied in R using tidy.</p>
<ul>
<li>Download and unzip the following: <a href="https://github.com/jmontgomery/jmontgomery.github.io/blob/master/PDS/Datasets/Tweets.csv.zip" class="uri">https://github.com/jmontgomery/jmontgomery.github.io/blob/master/PDS/Datasets/Tweets.csv.zip</a></li>
<li>Read these in using the correct file address</li>
</ul>
<div class="sourceCode" id="section-cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb561-1"><a href="section-dplyr-and-tidy.html#section-cb561-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="section-cb561-2"><a href="section-dplyr-and-tidy.html#section-cb561-2"></a>mayors &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;../Datasets/Mayors.csv&quot;</span>)</span>
<span id="section-cb561-3"><a href="section-dplyr-and-tidy.html#section-cb561-3"></a>tweets&lt;-<span class="kw">read_csv</span>(<span class="st">&quot;C:/Users/maria/OneDrive/WUSTL/2019-20/PDS/Tweets.csv&quot;</span>)</span>
<span id="section-cb561-4"><a href="section-dplyr-and-tidy.html#section-cb561-4"></a><span class="kw">print</span>(<span class="kw">object.size</span>(mayors), <span class="dt">units=</span><span class="st">&quot;auto&quot;</span>)</span></code></pre></div>
<pre><code>## 1.5 Mb</code></pre>
<div class="sourceCode" id="section-cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb563-1"><a href="section-dplyr-and-tidy.html#section-cb563-1"></a><span class="kw">print</span>(<span class="kw">object.size</span>(tweets), <span class="dt">units=</span><span class="st">&quot;auto&quot;</span>)</span></code></pre></div>
<pre><code>## 180.1 Mb</code></pre>
<p>There are various ways we might want to work across levels</p>
<ul>
<li><em>Mutating joins</em>, where you make a new variable constructed form matched observations in the other. E.g., how many tweets for each mayor</li>
<li><em>Filtering joins</em>, where you filter cases based on whether they match across. E.g., filter to mayors who have tweets.</li>
<li><em>Combining</em> the datasets in various ways to construct new databases with rows and columns that meet desired specifications. E.g., Tweets of all moyors from Indiana.</li>
</ul>
<div class="sourceCode" id="section-cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb565-1"><a href="section-dplyr-and-tidy.html#section-cb565-1"></a>mayors</span></code></pre></div>
<pre><code>## # A tibble: 1,473 x 51
##       X1 MayorID FullName LastName FirstName GenderMale GenderFemale RaceWhite
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;
##  1     1       1 Marty H~ Handlon  Marty              0            1         1
##  2     2       2 Bill Ha~ Ham Jr.  Bill               1            0         1
##  3     3       3 Randall~ Woodfin  Randall            1            0         0
##  4     4       4 Tab Bow~ Bowling  Tab                1            0         1
##  5     5       5 Mark Sa~ Saliba   Mark               1            0         1
##  6     6       6 Steve H~ Holt     Steve              1            0         1
##  7     7       7 Sherman~ Guyton   Sherman            1            0         1
##  8     8       8 Frank V~ Brocato  Frank V.           1            0         1
##  9     9       9 Tommy B~ Battle   Tommy              1            0         1
## 10    10      10 Paul Fi~ Finley   Paul               1            0         1
## # ... with 1,463 more rows, and 43 more variables: RaceBlack &lt;dbl&gt;,
## #   RaceHispanic &lt;dbl&gt;, RaceOther &lt;dbl&gt;, PartyRepublican &lt;dbl&gt;,
## #   PartyDemocrat &lt;dbl&gt;, PartyNonPartisan &lt;dbl&gt;, PartyOther &lt;dbl&gt;,
## #   Ideology &lt;dbl&gt;, IdeologySD &lt;dbl&gt;, LastElectionDate &lt;chr&gt;,
## #   PercentVote &lt;dbl&gt;, YearsCurrentPosition &lt;dbl&gt;, CityManager &lt;dbl&gt;,
## #   CouncilManager &lt;dbl&gt;, MayorCouncil &lt;dbl&gt;, Title &lt;chr&gt;, CityID &lt;dbl&gt;,
## #   CityName &lt;chr&gt;, CityNameFull &lt;chr&gt;, CensusID &lt;chr&gt;, CensusID2 &lt;dbl&gt;,
## #   State &lt;chr&gt;, StateAB &lt;chr&gt;, Region &lt;dbl&gt;, Division &lt;dbl&gt;, StateFIPS &lt;dbl&gt;,
## #   Population &lt;dbl&gt;, Latitude &lt;dbl&gt;, Longitude &lt;dbl&gt;, CityAge &lt;dbl&gt;,
## #   CityMale &lt;dbl&gt;, CityFemale &lt;dbl&gt;, CityWhite &lt;dbl&gt;, CityBlack &lt;dbl&gt;,
## #   CityHispanic &lt;dbl&gt;, CityOwner &lt;dbl&gt;, CityRenter &lt;dbl&gt;, GovWebsite &lt;chr&gt;,
## #   FacebookPageName &lt;chr&gt;, FacebookPageID &lt;dbl&gt;, FacebookLink &lt;chr&gt;,
## #   TwitterHandle &lt;chr&gt;, TwitterLink &lt;chr&gt;</code></pre>
<div class="sourceCode" id="section-cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb567-1"><a href="section-dplyr-and-tidy.html#section-cb567-1"></a>tweets</span></code></pre></div>
<pre><code>## # A tibble: 604,818 x 17
##       X1 TweetID ScreenName Text  CreatedTime         Favorited FavoritesCount
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt; &lt;dttm&gt;                  &lt;dbl&gt;          &lt;dbl&gt;
##  1     1 9.90e17 a_silberb~ &quot;Man~ 2018-04-28 22:26:48         0              9
##  2     2 9.90e17 a_silberb~ &quot;Suc~ 2018-04-28 22:13:38         0              8
##  3     3 9.90e17 a_silberb~ &quot;Won~ 2018-04-28 19:42:14         0             11
##  4     4 9.90e17 a_silberb~ &quot;I e~ 2018-04-28 14:42:20         0              8
##  5     5 9.90e17 a_silberb~ &quot;At ~ 2018-04-28 13:58:39         0              7
##  6     6 9.90e17 a_silberb~ &quot;Won~ 2018-04-28 13:53:21         0              6
##  7     7 9.90e17 a_silberb~ &quot;RT ~ 2018-04-28 12:26:17         0              0
##  8     8 9.90e17 a_silberb~ &quot;My ~ 2018-04-27 16:31:34         0              4
##  9     9 9.90e17 a_silberb~ &quot;At ~ 2018-04-27 16:31:23         0              6
## 10    10 9.90e17 a_silberb~ &quot;I e~ 2018-04-27 03:19:42         0              6
## # ... with 604,808 more rows, and 10 more variables: IsRetweet &lt;dbl&gt;,
## #   RetweetCount &lt;dbl&gt;, Retweeted &lt;dbl&gt;, ReplyToSN &lt;chr&gt;, ReplyToSID &lt;dbl&gt;,
## #   ReplyToUID &lt;dbl&gt;, Truncated &lt;dbl&gt;, StatusSource &lt;chr&gt;, Longitude &lt;dbl&gt;,
## #   Latitude &lt;dbl&gt;</code></pre>
<p>This is a simple relational databset that connects tweets to mayors.</p>
<ul>
<li>The variable ‘TwitterHandle’ in the mayors dataset should match up to ‘ScreenName’ in the tweets data.</li>
<li>But it will help you get the basics here.</li>
<li>These variables will serve to link across datasets.</li>
<li>Let’s rename so they are the same</li>
</ul>
<div class="sourceCode" id="section-cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb569-1"><a href="section-dplyr-and-tidy.html#section-cb569-1"></a>tweets &lt;-<span class="st"> </span><span class="kw">rename</span>(tweets, <span class="dt">TwitterHandle=</span>ScreenName)</span>
<span id="section-cb569-2"><a href="section-dplyr-and-tidy.html#section-cb569-2"></a>tweets</span></code></pre></div>
<pre><code>## # A tibble: 604,818 x 17
##       X1 TweetID TwitterHandle Text  CreatedTime         Favorited
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;dttm&gt;                  &lt;dbl&gt;
##  1     1 9.90e17 a_silberberg  &quot;Man~ 2018-04-28 22:26:48         0
##  2     2 9.90e17 a_silberberg  &quot;Suc~ 2018-04-28 22:13:38         0
##  3     3 9.90e17 a_silberberg  &quot;Won~ 2018-04-28 19:42:14         0
##  4     4 9.90e17 a_silberberg  &quot;I e~ 2018-04-28 14:42:20         0
##  5     5 9.90e17 a_silberberg  &quot;At ~ 2018-04-28 13:58:39         0
##  6     6 9.90e17 a_silberberg  &quot;Won~ 2018-04-28 13:53:21         0
##  7     7 9.90e17 a_silberberg  &quot;RT ~ 2018-04-28 12:26:17         0
##  8     8 9.90e17 a_silberberg  &quot;My ~ 2018-04-27 16:31:34         0
##  9     9 9.90e17 a_silberberg  &quot;At ~ 2018-04-27 16:31:23         0
## 10    10 9.90e17 a_silberberg  &quot;I e~ 2018-04-27 03:19:42         0
## # ... with 604,808 more rows, and 11 more variables: FavoritesCount &lt;dbl&gt;,
## #   IsRetweet &lt;dbl&gt;, RetweetCount &lt;dbl&gt;, Retweeted &lt;dbl&gt;, ReplyToSN &lt;chr&gt;,
## #   ReplyToSID &lt;dbl&gt;, ReplyToUID &lt;dbl&gt;, Truncated &lt;dbl&gt;, StatusSource &lt;chr&gt;,
## #   Longitude &lt;dbl&gt;, Latitude &lt;dbl&gt;</code></pre>
<ul>
<li>But each dataset will also need a <code>key</code> – a unique identier</li>
<li>Let’s actually look to see if these are unique identifiers?</li>
</ul>
<div class="sourceCode" id="section-cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb571-1"><a href="section-dplyr-and-tidy.html#section-cb571-1"></a>mayors <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb571-2"><a href="section-dplyr-and-tidy.html#section-cb571-2"></a><span class="st">  </span><span class="kw">count</span>(TwitterHandle) <span class="op">%&gt;%</span></span>
<span id="section-cb571-3"><a href="section-dplyr-and-tidy.html#section-cb571-3"></a><span class="st">  </span><span class="kw">filter</span>(n<span class="op">&gt;</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   TwitterHandle      n
##   &lt;chr&gt;          &lt;int&gt;
## 1 robertgarcialb     2
## 2 rodhiggins2017     2
## 3 &lt;NA&gt;             743</code></pre>
<div class="sourceCode" id="section-cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb573-1"><a href="section-dplyr-and-tidy.html#section-cb573-1"></a>tweets <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb573-2"><a href="section-dplyr-and-tidy.html#section-cb573-2"></a><span class="st">  </span><span class="kw">count</span>(TweetID) <span class="op">%&gt;%</span></span>
<span id="section-cb573-3"><a href="section-dplyr-and-tidy.html#section-cb573-3"></a><span class="st">  </span><span class="kw">filter</span>(n<span class="op">&gt;</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   TweetID     n
##     &lt;dbl&gt; &lt;int&gt;
## 1 4.13e17     2
## 2 7.78e17     2</code></pre>
<p>Hmmm … you might want to figure out these duplicates before running any analyses.</p>
<div id="section-mutating-join" class="section level3" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Mutating join</h3>
<ul>
<li>A mutating join adds variables to the right on your datset</li>
</ul>
<div class="sourceCode" id="section-cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb575-1"><a href="section-dplyr-and-tidy.html#section-cb575-1"></a>tweets <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb575-2"><a href="section-dplyr-and-tidy.html#section-cb575-2"></a><span class="st">  </span><span class="kw">left_join</span>(<span class="kw">select</span>(mayors, TwitterHandle, LastName), </span>
<span id="section-cb575-3"><a href="section-dplyr-and-tidy.html#section-cb575-3"></a>            <span class="dt">by=</span><span class="st">&quot;TwitterHandle&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 608,006 x 18
##       X1 TweetID TwitterHandle Text  CreatedTime         Favorited
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;dttm&gt;                  &lt;dbl&gt;
##  1     1 9.90e17 a_silberberg  &quot;Man~ 2018-04-28 22:26:48         0
##  2     2 9.90e17 a_silberberg  &quot;Suc~ 2018-04-28 22:13:38         0
##  3     3 9.90e17 a_silberberg  &quot;Won~ 2018-04-28 19:42:14         0
##  4     4 9.90e17 a_silberberg  &quot;I e~ 2018-04-28 14:42:20         0
##  5     5 9.90e17 a_silberberg  &quot;At ~ 2018-04-28 13:58:39         0
##  6     6 9.90e17 a_silberberg  &quot;Won~ 2018-04-28 13:53:21         0
##  7     7 9.90e17 a_silberberg  &quot;RT ~ 2018-04-28 12:26:17         0
##  8     8 9.90e17 a_silberberg  &quot;My ~ 2018-04-27 16:31:34         0
##  9     9 9.90e17 a_silberberg  &quot;At ~ 2018-04-27 16:31:23         0
## 10    10 9.90e17 a_silberberg  &quot;I e~ 2018-04-27 03:19:42         0
## # ... with 607,996 more rows, and 12 more variables: FavoritesCount &lt;dbl&gt;,
## #   IsRetweet &lt;dbl&gt;, RetweetCount &lt;dbl&gt;, Retweeted &lt;dbl&gt;, ReplyToSN &lt;chr&gt;,
## #   ReplyToSID &lt;dbl&gt;, ReplyToUID &lt;dbl&gt;, Truncated &lt;dbl&gt;, StatusSource &lt;chr&gt;,
## #   Longitude &lt;dbl&gt;, Latitude &lt;dbl&gt;, LastName &lt;chr&gt;</code></pre>
</div>
<div id="section-joins-topography" class="section level3" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> Joins topography</h3>
<ul>
<li>“Inner joins” produce results only where the linking variable appears on both tables</li>
<li>“Outer joins” produce results with all data, and fills in missing values as necessary
<ul>
<li>Left join keeps only observations from the first specified data if their is no match.</li>
<li>Right join keeps only observations from the second data</li>
<li>Full join keeps everything</li>
</ul></li>
<li>Let’s draw up the venn diagrams for:
<ul>
<li>Inner joins</li>
<li>Left joins</li>
<li>Right joins</li>
<li>Full joins</li>
</ul></li>
</ul>
</div>
<div id="section-many-and-one-to-many" class="section level3" number="7.3.3">
<h3><span class="header-section-number">7.3.3</span> Many and one-to-many</h3>
<ul>
<li>The join we did above was a one-to-many join, where the last name was added to all of the tweets for that mayor.</li>
<li>But I did this on purpose and it can go awry when the keys are not as unique as you think they are.</li>
<li>Joins when there are duplicates lead to creations of new rows for all possible combinations.</li>
</ul>
</div>
<div id="section-filtering-joins" class="section level3" number="7.3.4">
<h3><span class="header-section-number">7.3.4</span> Filtering joins</h3>
<ul>
<li><p><code>semi_join(x, y)</code> keeps all observations in x that have a match in y.</p></li>
<li><p><code>anti_join(x, y)</code> drops all observations in x that have a match in y.</p></li>
<li><p>The latter is very useful for figuring out why your joins are not working as you expect.<br />
</p></li>
<li><p>For important data merges, you should always run these to be sure that these are returning the values and numbers you expect.</p></li>
</ul>
</div>
<div id="section-set-operations" class="section level3" number="7.3.5">
<h3><span class="header-section-number">7.3.5</span> Set operations</h3>
<p>Tidy also includes functions where it expects datasets with the same columns.</p>
<ul>
<li><code>intersect(x, y)</code> will return only observations in both x and y.</li>
<li><code>union(x, y)</code> will return unique observations in both x and y.</li>
<li><code>setdiff(x, y)</code> will return observations in x, but not in y.</li>
</ul>
<p>This is useful for deduplication tasks and also for identifying problems from specific merge commands.</p>
</div>
<div id="section-exercise" class="section level3" number="7.3.6">
<h3><span class="header-section-number">7.3.6</span> Exercise</h3>
<p>Add a third set of data — mentions</p>
<div class="sourceCode" id="section-cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb577-1"><a href="section-dplyr-and-tidy.html#section-cb577-1"></a>mentions &lt;-<span class="kw">read_csv</span>(<span class="st">&quot;../Datasets/TwitterMentions.csv&quot;</span>)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>For each mayor, calculate the number of times they were mentioned</li>
</ol>
<div class="sourceCode" id="section-cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb578-1"><a href="section-dplyr-and-tidy.html#section-cb578-1"></a>mentions</span></code></pre></div>
<pre><code>## # A tibble: 61,570 x 18
##       X1 TweetID ScreenName Text  MayorHandle CreatedTime         Favorited
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;       &lt;dttm&gt;                  &lt;dbl&gt;
##  1     1 9.91e17 visitdelr~ Join~ a_silberbe~ 2018-04-30 16:59:14         0
##  2     2 9.91e17 SatirclAlx .@AC~ a_silberbe~ 2018-04-30 15:44:37         0
##  3     3 9.91e17 Madelined~ @A_S~ a_silberbe~ 2018-04-30 00:28:15         0
##  4     4 9.90e17 Her_Grace_ Anot~ a_silberbe~ 2018-04-29 04:02:13         0
##  5     5 9.90e17 jamesjhare @nat~ a_silberbe~ 2018-04-29 00:04:25         0
##  6     6 9.90e17 A_Silberb~ Many~ a_silberbe~ 2018-04-28 22:26:48         0
##  7     7 9.90e17 rossi4va   @hok~ a_silberbe~ 2018-04-28 22:22:11         0
##  8     8 9.90e17 hokiesmas~ @nat~ a_silberbe~ 2018-04-28 22:21:00         0
##  9     9 9.90e17 rossi4va   RT @~ a_silberbe~ 2018-04-28 22:19:42         0
## 10    10 9.90e17 A_Silberb~ Such~ a_silberbe~ 2018-04-28 22:13:38         0
## # ... with 61,560 more rows, and 11 more variables: FavoritesCount &lt;dbl&gt;,
## #   IsRetweet &lt;dbl&gt;, RetweetCount &lt;dbl&gt;, Retweeted &lt;dbl&gt;, ReplyToSN &lt;chr&gt;,
## #   ReplyToSID &lt;dbl&gt;, ReplyToUID &lt;dbl&gt;, Truncated &lt;dbl&gt;, StatusSource &lt;chr&gt;,
## #   Longitude &lt;dbl&gt;, Latitude &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="section-cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb580-1"><a href="section-dplyr-and-tidy.html#section-cb580-1"></a>mayors</span></code></pre></div>
<pre><code>## # A tibble: 1,473 x 51
##       X1 MayorID FullName LastName FirstName GenderMale GenderFemale RaceWhite
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;
##  1     1       1 Marty H~ Handlon  Marty              0            1         1
##  2     2       2 Bill Ha~ Ham Jr.  Bill               1            0         1
##  3     3       3 Randall~ Woodfin  Randall            1            0         0
##  4     4       4 Tab Bow~ Bowling  Tab                1            0         1
##  5     5       5 Mark Sa~ Saliba   Mark               1            0         1
##  6     6       6 Steve H~ Holt     Steve              1            0         1
##  7     7       7 Sherman~ Guyton   Sherman            1            0         1
##  8     8       8 Frank V~ Brocato  Frank V.           1            0         1
##  9     9       9 Tommy B~ Battle   Tommy              1            0         1
## 10    10      10 Paul Fi~ Finley   Paul               1            0         1
## # ... with 1,463 more rows, and 43 more variables: RaceBlack &lt;dbl&gt;,
## #   RaceHispanic &lt;dbl&gt;, RaceOther &lt;dbl&gt;, PartyRepublican &lt;dbl&gt;,
## #   PartyDemocrat &lt;dbl&gt;, PartyNonPartisan &lt;dbl&gt;, PartyOther &lt;dbl&gt;,
## #   Ideology &lt;dbl&gt;, IdeologySD &lt;dbl&gt;, LastElectionDate &lt;chr&gt;,
## #   PercentVote &lt;dbl&gt;, YearsCurrentPosition &lt;dbl&gt;, CityManager &lt;dbl&gt;,
## #   CouncilManager &lt;dbl&gt;, MayorCouncil &lt;dbl&gt;, Title &lt;chr&gt;, CityID &lt;dbl&gt;,
## #   CityName &lt;chr&gt;, CityNameFull &lt;chr&gt;, CensusID &lt;chr&gt;, CensusID2 &lt;dbl&gt;,
## #   State &lt;chr&gt;, StateAB &lt;chr&gt;, Region &lt;dbl&gt;, Division &lt;dbl&gt;, StateFIPS &lt;dbl&gt;,
## #   Population &lt;dbl&gt;, Latitude &lt;dbl&gt;, Longitude &lt;dbl&gt;, CityAge &lt;dbl&gt;,
## #   CityMale &lt;dbl&gt;, CityFemale &lt;dbl&gt;, CityWhite &lt;dbl&gt;, CityBlack &lt;dbl&gt;,
## #   CityHispanic &lt;dbl&gt;, CityOwner &lt;dbl&gt;, CityRenter &lt;dbl&gt;, GovWebsite &lt;chr&gt;,
## #   FacebookPageName &lt;chr&gt;, FacebookPageID &lt;dbl&gt;, FacebookLink &lt;chr&gt;,
## #   TwitterHandle &lt;chr&gt;, TwitterLink &lt;chr&gt;</code></pre>
<div class="sourceCode" id="section-cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb582-1"><a href="section-dplyr-and-tidy.html#section-cb582-1"></a>mentions &lt;-<span class="st"> </span><span class="kw">rename</span>(mentions, <span class="dt">TwitterHandle =</span> <span class="st">&quot;ScreenName&quot;</span>)</span>
<span id="section-cb582-2"><a href="section-dplyr-and-tidy.html#section-cb582-2"></a>mentionsCount &lt;-<span class="st"> </span>mentions <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(MayorHandle) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>()</span>
<span id="section-cb582-3"><a href="section-dplyr-and-tidy.html#section-cb582-3"></a>answer1 &lt;-<span class="st"> </span>mayors <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(mentionsCount, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;TwitterHandle&quot;</span> =<span class="st"> &quot;MayorHandle&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(TwitterHandle, FullName, n) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</span>
<span id="section-cb582-4"><a href="section-dplyr-and-tidy.html#section-cb582-4"></a>answer1</span></code></pre></div>
<pre><code>## # A tibble: 1,473 x 3
##    TwitterHandle   FullName                    n
##    &lt;chr&gt;           &lt;chr&gt;                   &lt;int&gt;
##  1 markfarrellsf   Mark Farrell             1000
##  2 sam_hindi       Sam Hindi                1000
##  3 andrewgillum    Andrew D. Gillum         1000
##  4 keishabottoms   Keisha Lance Bottoms     1000
##  5 chicagosmayor   Rahm Emmanuel            1000
##  6 indymayorjoe    Joseph &#39;Joe&#39; H. Hogsett  1000
##  7 louisvillemayor Greg Fischer             1000
##  8 billdeblasio    Bill de Blasio           1000
##  9 billpeduto      William Peduto           1000
## 10 mayorbriley     David Briley              999
## # ... with 1,463 more rows</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Add to the mayors datset the number of times each mayor tweeted.</li>
</ol>
<div class="sourceCode" id="section-cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb584-1"><a href="section-dplyr-and-tidy.html#section-cb584-1"></a>tweetCounts &lt;-<span class="st"> </span>tweets <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(TwitterHandle) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>()</span>
<span id="section-cb584-2"><a href="section-dplyr-and-tidy.html#section-cb584-2"></a>answer2 &lt;-<span class="st"> </span>mayors <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(tweetCounts, <span class="dt">by=</span><span class="st">&quot;TwitterHandle&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</span>
<span id="section-cb584-3"><a href="section-dplyr-and-tidy.html#section-cb584-3"></a>answer2</span></code></pre></div>
<pre><code>## # A tibble: 1,473 x 52
##       X1 MayorID FullName LastName FirstName GenderMale GenderFemale RaceWhite
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;
##  1    11      11 William~ Stimpson William ~          1            0         1
##  2   443     443 Thomas ~ Masters  Thomas A.          1            0         0
##  3   498     498 Rahm Em~ Emmanuel Rahm               1            0         1
##  4   778     778 Emily L~ Larson   Emily              0            1         1
##  5   812     812 Jason L~ Shelton  Jason L.           1            0         1
##  6   902     902 Derek A~ Armstead Derek              1            0         0
##  7  1070    1071 Greg Pe~ Peterson Greg               1            0         1
##  8  1140    1141 Jim Ken~ Kenney   Jim                1            0         1
##  9  1142    1143 Ed Pawl~ Pawlows~ Ed                 1            0         1
## 10    37      37 Greg St~ Stanton  Greg               1            0         1
## # ... with 1,463 more rows, and 44 more variables: RaceBlack &lt;dbl&gt;,
## #   RaceHispanic &lt;dbl&gt;, RaceOther &lt;dbl&gt;, PartyRepublican &lt;dbl&gt;,
## #   PartyDemocrat &lt;dbl&gt;, PartyNonPartisan &lt;dbl&gt;, PartyOther &lt;dbl&gt;,
## #   Ideology &lt;dbl&gt;, IdeologySD &lt;dbl&gt;, LastElectionDate &lt;chr&gt;,
## #   PercentVote &lt;dbl&gt;, YearsCurrentPosition &lt;dbl&gt;, CityManager &lt;dbl&gt;,
## #   CouncilManager &lt;dbl&gt;, MayorCouncil &lt;dbl&gt;, Title &lt;chr&gt;, CityID &lt;dbl&gt;,
## #   CityName &lt;chr&gt;, CityNameFull &lt;chr&gt;, CensusID &lt;chr&gt;, CensusID2 &lt;dbl&gt;,
## #   State &lt;chr&gt;, StateAB &lt;chr&gt;, Region &lt;dbl&gt;, Division &lt;dbl&gt;, StateFIPS &lt;dbl&gt;,
## #   Population &lt;dbl&gt;, Latitude &lt;dbl&gt;, Longitude &lt;dbl&gt;, CityAge &lt;dbl&gt;,
## #   CityMale &lt;dbl&gt;, CityFemale &lt;dbl&gt;, CityWhite &lt;dbl&gt;, CityBlack &lt;dbl&gt;,
## #   CityHispanic &lt;dbl&gt;, CityOwner &lt;dbl&gt;, CityRenter &lt;dbl&gt;, GovWebsite &lt;chr&gt;,
## #   FacebookPageName &lt;chr&gt;, FacebookPageID &lt;dbl&gt;, FacebookLink &lt;chr&gt;,
## #   TwitterHandle &lt;chr&gt;, TwitterLink &lt;chr&gt;, n &lt;int&gt;</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Create a combined dataset of all tweets from the tweets and mentions data. Subset down to overlapping columns (and rename where needed) to make this easy.</li>
</ol>
<div class="sourceCode" id="section-cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb586-1"><a href="section-dplyr-and-tidy.html#section-cb586-1"></a>allData &lt;-<span class="st"> </span><span class="kw">full_join</span>(tweets, mentions)</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;X1&quot;, &quot;TweetID&quot;, &quot;TwitterHandle&quot;, &quot;Text&quot;, &quot;CreatedTime&quot;, &quot;Favorited&quot;, &quot;FavoritesCount&quot;, &quot;IsRetweet&quot;, &quot;RetweetCount&quot;, &quot;Retweeted&quot;, &quot;ReplyToSN&quot;, &quot;ReplyToSID&quot;, &quot;ReplyToUID&quot;, &quot;Truncated&quot;, &quot;StatusSource&quot;, &quot;Longitude&quot;, &quot;Latitude&quot;)</code></pre>
<div class="sourceCode" id="section-cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb588-1"><a href="section-dplyr-and-tidy.html#section-cb588-1"></a>allData</span></code></pre></div>
<pre><code>## # A tibble: 666,388 x 18
##       X1 TweetID TwitterHandle Text  CreatedTime         Favorited
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;dttm&gt;                  &lt;dbl&gt;
##  1     1 9.90e17 a_silberberg  &quot;Man~ 2018-04-28 22:26:48         0
##  2     2 9.90e17 a_silberberg  &quot;Suc~ 2018-04-28 22:13:38         0
##  3     3 9.90e17 a_silberberg  &quot;Won~ 2018-04-28 19:42:14         0
##  4     4 9.90e17 a_silberberg  &quot;I e~ 2018-04-28 14:42:20         0
##  5     5 9.90e17 a_silberberg  &quot;At ~ 2018-04-28 13:58:39         0
##  6     6 9.90e17 a_silberberg  &quot;Won~ 2018-04-28 13:53:21         0
##  7     7 9.90e17 a_silberberg  &quot;RT ~ 2018-04-28 12:26:17         0
##  8     8 9.90e17 a_silberberg  &quot;My ~ 2018-04-27 16:31:34         0
##  9     9 9.90e17 a_silberberg  &quot;At ~ 2018-04-27 16:31:23         0
## 10    10 9.90e17 a_silberberg  &quot;I e~ 2018-04-27 03:19:42         0
## # ... with 666,378 more rows, and 12 more variables: FavoritesCount &lt;dbl&gt;,
## #   IsRetweet &lt;dbl&gt;, RetweetCount &lt;dbl&gt;, Retweeted &lt;dbl&gt;, ReplyToSN &lt;chr&gt;,
## #   ReplyToSID &lt;dbl&gt;, ReplyToUID &lt;dbl&gt;, Truncated &lt;dbl&gt;, StatusSource &lt;chr&gt;,
## #   Longitude &lt;dbl&gt;, Latitude &lt;dbl&gt;, MayorHandle &lt;chr&gt;</code></pre>
</div>
</div>
<div id="section-stringr" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> <code>stringr</code></h2>
<p><code>stringr</code> is a tidy package that is used for processing strings and text data</p>
<div class="sourceCode" id="section-cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb590-1"><a href="section-dplyr-and-tidy.html#section-cb590-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="section-cb590-2"><a href="section-dplyr-and-tidy.html#section-cb590-2"></a>tweets&lt;-<span class="kw">read_csv</span>(<span class="st">&quot;C:/Users/maria/OneDrive/WUSTL/2019-20/PDS/Tweets.csv&quot;</span>)</span>
<span id="section-cb590-3"><a href="section-dplyr-and-tidy.html#section-cb590-3"></a></span>
<span id="section-cb590-4"><a href="section-dplyr-and-tidy.html#section-cb590-4"></a>aTweet&lt;-tweets[<span class="dv">1</span>,]<span class="op">$</span>Text</span>
<span id="section-cb590-5"><a href="section-dplyr-and-tidy.html#section-cb590-5"></a>aTweet</span></code></pre></div>
<pre><code>## [1] &quot;Many thanks to everyone involved in Alexandria&#39;s #EarthDay celebration. Together, we are reducing pollution and was… https://t.co/wwMOIg4t1w&quot;</code></pre>
<div class="sourceCode" id="section-cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb592-1"><a href="section-dplyr-and-tidy.html#section-cb592-1"></a><span class="kw">str_length</span>(aTweet)</span></code></pre></div>
<pre><code>## [1] 140</code></pre>
<div class="sourceCode" id="section-cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb594-1"><a href="section-dplyr-and-tidy.html#section-cb594-1"></a>words&lt;-<span class="kw">str_split</span>(aTweet, <span class="dt">pattern =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="section-cb594-2"><a href="section-dplyr-and-tidy.html#section-cb594-2"></a>words</span></code></pre></div>
<pre><code>## [[1]]
##  [1] &quot;Many&quot;                    &quot;thanks&quot;                 
##  [3] &quot;to&quot;                      &quot;everyone&quot;               
##  [5] &quot;involved&quot;                &quot;in&quot;                     
##  [7] &quot;Alexandria&#39;s&quot;            &quot;#EarthDay&quot;              
##  [9] &quot;celebration.&quot;            &quot;Together,&quot;              
## [11] &quot;we&quot;                      &quot;are&quot;                    
## [13] &quot;reducing&quot;                &quot;pollution&quot;              
## [15] &quot;and&quot;                     &quot;was…&quot;                   
## [17] &quot;https://t.co/wwMOIg4t1w&quot;</code></pre>
<div class="sourceCode" id="section-cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb596-1"><a href="section-dplyr-and-tidy.html#section-cb596-1"></a><span class="kw">str_c</span>(words)</span></code></pre></div>
<pre><code>## [1] &quot;c(\&quot;Many\&quot;, \&quot;thanks\&quot;, \&quot;to\&quot;, \&quot;everyone\&quot;, \&quot;involved\&quot;, \&quot;in\&quot;, \&quot;Alexandria&#39;s\&quot;, \&quot;#EarthDay\&quot;, \&quot;celebration.\&quot;, \&quot;Together,\&quot;, \&quot;we\&quot;, \&quot;are\&quot;, \&quot;reducing\&quot;, \&quot;pollution\&quot;, \&quot;and\&quot;, \&quot;was…\&quot;, \&quot;https://t.co/wwMOIg4t1w\&quot;)&quot;</code></pre>
<div class="sourceCode" id="section-cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb598-1"><a href="section-dplyr-and-tidy.html#section-cb598-1"></a><span class="kw">str_c</span>(<span class="kw">unlist</span>(words))</span></code></pre></div>
<pre><code>##  [1] &quot;Many&quot;                    &quot;thanks&quot;                 
##  [3] &quot;to&quot;                      &quot;everyone&quot;               
##  [5] &quot;involved&quot;                &quot;in&quot;                     
##  [7] &quot;Alexandria&#39;s&quot;            &quot;#EarthDay&quot;              
##  [9] &quot;celebration.&quot;            &quot;Together,&quot;              
## [11] &quot;we&quot;                      &quot;are&quot;                    
## [13] &quot;reducing&quot;                &quot;pollution&quot;              
## [15] &quot;and&quot;                     &quot;was…&quot;                   
## [17] &quot;https://t.co/wwMOIg4t1w&quot;</code></pre>
<div class="sourceCode" id="section-cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb600-1"><a href="section-dplyr-and-tidy.html#section-cb600-1"></a><span class="kw">str_c</span>(<span class="kw">unlist</span>(words), <span class="st">&quot;Added&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;ManyAdded&quot;                    &quot;thanksAdded&quot;                 
##  [3] &quot;toAdded&quot;                      &quot;everyoneAdded&quot;               
##  [5] &quot;involvedAdded&quot;                &quot;inAdded&quot;                     
##  [7] &quot;Alexandria&#39;sAdded&quot;            &quot;#EarthDayAdded&quot;              
##  [9] &quot;celebration.Added&quot;            &quot;Together,Added&quot;              
## [11] &quot;weAdded&quot;                      &quot;areAdded&quot;                    
## [13] &quot;reducingAdded&quot;                &quot;pollutionAdded&quot;              
## [15] &quot;andAdded&quot;                     &quot;was…Added&quot;                   
## [17] &quot;https://t.co/wwMOIg4t1wAdded&quot;</code></pre>
<div class="sourceCode" id="section-cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb602-1"><a href="section-dplyr-and-tidy.html#section-cb602-1"></a><span class="kw">str_c</span>(<span class="kw">unlist</span>(words), <span class="st">&quot;Added&quot;</span>, <span class="dt">sep=</span><span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;Many Added&quot;                    &quot;thanks Added&quot;                 
##  [3] &quot;to Added&quot;                      &quot;everyone Added&quot;               
##  [5] &quot;involved Added&quot;                &quot;in Added&quot;                     
##  [7] &quot;Alexandria&#39;s Added&quot;            &quot;#EarthDay Added&quot;              
##  [9] &quot;celebration. Added&quot;            &quot;Together, Added&quot;              
## [11] &quot;we Added&quot;                      &quot;are Added&quot;                    
## [13] &quot;reducing Added&quot;                &quot;pollution Added&quot;              
## [15] &quot;and Added&quot;                     &quot;was… Added&quot;                   
## [17] &quot;https://t.co/wwMOIg4t1w Added&quot;</code></pre>
<div class="sourceCode" id="section-cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb604-1"><a href="section-dplyr-and-tidy.html#section-cb604-1"></a><span class="kw">str_c</span>(<span class="st">&quot;Before&quot;</span>, <span class="kw">unlist</span>(words), <span class="st">&quot;Added&quot;</span>, <span class="dt">sep=</span><span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;Before Many Added&quot;                   
##  [2] &quot;Before thanks Added&quot;                 
##  [3] &quot;Before to Added&quot;                     
##  [4] &quot;Before everyone Added&quot;               
##  [5] &quot;Before involved Added&quot;               
##  [6] &quot;Before in Added&quot;                     
##  [7] &quot;Before Alexandria&#39;s Added&quot;           
##  [8] &quot;Before #EarthDay Added&quot;              
##  [9] &quot;Before celebration. Added&quot;           
## [10] &quot;Before Together, Added&quot;              
## [11] &quot;Before we Added&quot;                     
## [12] &quot;Before are Added&quot;                    
## [13] &quot;Before reducing Added&quot;               
## [14] &quot;Before pollution Added&quot;              
## [15] &quot;Before and Added&quot;                    
## [16] &quot;Before was… Added&quot;                   
## [17] &quot;Before https://t.co/wwMOIg4t1w Added&quot;</code></pre>
<p>Or you may want to assemble it all into all back into a coherent whole</p>
<div class="sourceCode" id="section-cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb606-1"><a href="section-dplyr-and-tidy.html#section-cb606-1"></a><span class="kw">str_c</span>(<span class="kw">unlist</span>(words), <span class="dt">collapse=</span><span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Many thanks to everyone involved in Alexandria&#39;s #EarthDay celebration. Together, we are reducing pollution and was… https://t.co/wwMOIg4t1w&quot;</code></pre>
<div id="section-things-you-havent-thought-about-strings" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Things you haven’t thought about strings</h3>
<ul>
<li>Strings in memory are different than how they appear on the screen</li>
<li>You can use the function <code>writeLines</code> to see how a function would atually render to a reader (as opposed to how it is stored in the computer.)</li>
<li>The big confusion is that special characters have to be “escaped” or else they get in the way (From R4DS)</li>
</ul>
<div class="sourceCode" id="section-cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb608-1"><a href="section-dplyr-and-tidy.html#section-cb608-1"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">&quot;</span>)</span>
<span id="section-cb608-2"><a href="section-dplyr-and-tidy.html#section-cb608-2"></a>x</span></code></pre></div>
<pre><code>## [1] &quot;\&quot;&quot; &quot;\\&quot;</code></pre>
<div class="sourceCode" id="section-cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb610-1"><a href="section-dplyr-and-tidy.html#section-cb610-1"></a><span class="kw">writeLines</span>(x)</span></code></pre></div>
<pre><code>## &quot;
## \</code></pre>
<ul>
<li><p>Others to watch out for are <code>"\n"</code> and <code>"\t"</code> for <code>next line</code> and <code>tab</code></p></li>
<li><p><code>na</code> is a problem, so you might use <code>str_replace_na</code></p></li>
<li><p><code>stringr</code> replicates a lot of the functions we have already used for characters with (sometimes) slightly different syntax</p></li>
</ul>
<div class="sourceCode" id="section-cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb612-1"><a href="section-dplyr-and-tidy.html#section-cb612-1"></a>colors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;magenta&quot;</span>, <span class="st">&quot;cyan&quot;</span>)</span>
<span id="section-cb612-2"><a href="section-dplyr-and-tidy.html#section-cb612-2"></a><span class="kw">str_sub</span>(colors, <span class="dv">1</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] &quot;red&quot; &quot;yel&quot; &quot;blu&quot; &quot;gre&quot; &quot;mag&quot; &quot;cya&quot;</code></pre>
<div class="sourceCode" id="section-cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb614-1"><a href="section-dplyr-and-tidy.html#section-cb614-1"></a><span class="kw">str_sub</span>(colors, <span class="dv">-3</span>, <span class="dv">-1</span>) <span class="co">#count back from the end</span></span></code></pre></div>
<pre><code>## [1] &quot;red&quot; &quot;low&quot; &quot;lue&quot; &quot;een&quot; &quot;nta&quot; &quot;yan&quot;</code></pre>
<div class="sourceCode" id="section-cb616"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb616-1"><a href="section-dplyr-and-tidy.html#section-cb616-1"></a><span class="kw">str_sub</span>(colors, <span class="dv">1</span>, <span class="dv">10</span>) <span class="co"># Robust to going out of index</span></span></code></pre></div>
<pre><code>## [1] &quot;red&quot;     &quot;yellow&quot;  &quot;blue&quot;    &quot;green&quot;   &quot;magenta&quot; &quot;cyan&quot;</code></pre>
<div class="sourceCode" id="section-cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb618-1"><a href="section-dplyr-and-tidy.html#section-cb618-1"></a><span class="kw">str_sub</span>(colors, <span class="dv">1</span>, <span class="dv">3</span>)&lt;-<span class="kw">str_to_upper</span>(<span class="kw">str_sub</span>(colors, <span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="section-cb618-2"><a href="section-dplyr-and-tidy.html#section-cb618-2"></a>colors</span></code></pre></div>
<pre><code>## [1] &quot;RED&quot;     &quot;YELlow&quot;  &quot;BLUe&quot;    &quot;GREen&quot;   &quot;MAGenta&quot; &quot;CYAn&quot;</code></pre>
<div class="sourceCode" id="section-cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb620-1"><a href="section-dplyr-and-tidy.html#section-cb620-1"></a>colors&lt;-<span class="kw">str_to_lower</span>(colors)</span>
<span id="section-cb620-2"><a href="section-dplyr-and-tidy.html#section-cb620-2"></a>colors</span></code></pre></div>
<pre><code>## [1] &quot;red&quot;     &quot;yellow&quot;  &quot;blue&quot;    &quot;green&quot;   &quot;magenta&quot; &quot;cyan&quot;</code></pre>
<p>Example:</p>
<ol style="list-style-type: decimal">
<li>Filter down to all of the tweets from Mayor Lyda Krewson in our data</li>
<li>Find the mean number of words in her tweets. Find the total.</li>
<li>Take all of the words she has used and reduce them down to only their first five letters. Repeat (2) and compare.</li>
</ol>
<p>Question 2</p>
<div class="sourceCode" id="section-cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb622-1"><a href="section-dplyr-and-tidy.html#section-cb622-1"></a>hertweets &lt;-<span class="st"> </span><span class="kw">filter</span>(tweets, ScreenName <span class="op">==</span><span class="st"> &quot;lydakrewson&quot;</span>)[<span class="st">&quot;Text&quot;</span>]</span>
<span id="section-cb622-2"><a href="section-dplyr-and-tidy.html#section-cb622-2"></a>numWords &lt;-<span class="st"> </span>hertweets <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb622-3"><a href="section-dplyr-and-tidy.html#section-cb622-3"></a><span class="st">    </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb622-4"><a href="section-dplyr-and-tidy.html#section-cb622-4"></a><span class="st">    </span><span class="kw">transmute</span>(<span class="dt">numWords=</span> <span class="kw">length</span>(<span class="kw">unlist</span>(<span class="kw">str_split</span>(Text, <span class="st">&quot; &quot;</span>))))</span>
<span id="section-cb622-5"><a href="section-dplyr-and-tidy.html#section-cb622-5"></a>numWords</span></code></pre></div>
<pre><code>## Source: local data frame [3,191 x 1]
## Groups: &lt;by row&gt;
## 
## # A tibble: 3,191 x 1
##    numWords
##       &lt;int&gt;
##  1       20
##  2       25
##  3       20
##  4       20
##  5       17
##  6       21
##  7        8
##  8       11
##  9       19
## 10       13
## # ... with 3,181 more rows</code></pre>
<div class="sourceCode" id="section-cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb624-1"><a href="section-dplyr-and-tidy.html#section-cb624-1"></a><span class="kw">mean</span>(numWords<span class="op">$</span>numWords)</span></code></pre></div>
<pre><code>## [1] 16.58602</code></pre>
<div class="sourceCode" id="section-cb626"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb626-1"><a href="section-dplyr-and-tidy.html#section-cb626-1"></a><span class="kw">length</span>(<span class="kw">unique</span>(<span class="kw">unlist</span>(<span class="kw">str_split</span>(hertweets<span class="op">$</span>Text, <span class="st">&quot; &quot;</span>))))</span></code></pre></div>
<pre><code>## [1] 15960</code></pre>
<p>Question 3</p>
<div class="sourceCode" id="section-cb628"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb628-1"><a href="section-dplyr-and-tidy.html#section-cb628-1"></a><span class="kw">length</span>(<span class="kw">unique</span>(<span class="kw">str_sub</span>(<span class="kw">unlist</span>(<span class="kw">str_split</span>(hertweets<span class="op">$</span>Text, <span class="st">&quot; &quot;</span>)), <span class="dv">1</span>, <span class="dv">5</span>)))</span></code></pre></div>
<pre><code>## [1] 9831</code></pre>
</div>
</div>
<div id="section-pipes-and-maps" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Pipes and maps</h2>
<ul>
<li>Download: <a href="https://www.voterstudygroup.org/publication/2019-voter-survey-full-data-set" class="uri">https://www.voterstudygroup.org/publication/2019-voter-survey-full-data-set</a></li>
<li>Codebook: <a href="https://www.voterstudygroup.org/publication/2019-voter-survey-full-data-set" class="uri">https://www.voterstudygroup.org/publication/2019-voter-survey-full-data-set</a></li>
</ul>
<div class="sourceCode" id="section-cb630"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb630-1"><a href="section-dplyr-and-tidy.html#section-cb630-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="section-cb630-2"><a href="section-dplyr-and-tidy.html#section-cb630-2"></a>VSG&lt;-<span class="kw">read_csv</span>(<span class="st">&quot;C:/Users/maria/OneDrive/WUSTL/2019-20/PDS/VOTER_Survey_Jan217_Release1-csv.csv&quot;</span>, <span class="dt">col_types=</span><span class="kw">cols</span>(<span class="dt">weight_18_24_2018=</span><span class="st">&quot;d&quot;</span>))</span></code></pre></div>
<p>Question: Is there a lane?</p>
<p>We are going to:</p>
<ul>
<li>Subset the data to just favorability raitings for Elizabeth Warren and Bernie Sanders</li>
<li>Recode these variables into “approve” and “not approve”</li>
<li>Find the proportion of respondents who either approve or disapprove of <em>both</em></li>
</ul>
<p>One strategy is just to make new datsets for each step</p>
<div class="sourceCode" id="section-cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb631-1"><a href="section-dplyr-and-tidy.html#section-cb631-1"></a>VSG.two &lt;-<span class="st"> </span><span class="kw">select</span>(VSG, fav_sanders_<span class="dv">2019</span>, fav_warren_<span class="dv">2019</span>)</span>
<span id="section-cb631-2"><a href="section-dplyr-and-tidy.html#section-cb631-2"></a>VSG.three&lt;-<span class="kw">mutate</span>(VSG.two, <span class="dt">fav_sanders_binary =</span> (fav_sanders_<span class="dv">2019</span><span class="op">&lt;=</span><span class="dv">2</span>))</span>
<span id="section-cb631-3"><a href="section-dplyr-and-tidy.html#section-cb631-3"></a>VSG.four&lt;-<span class="kw">mutate</span>(VSG.three, <span class="dt">fav_sanders_binary=</span> <span class="kw">na_if</span>(fav_sanders_<span class="dv">2019</span>, fav_sanders_<span class="dv">2019</span><span class="op">&gt;</span><span class="dv">4</span>))</span></code></pre></div>
<p>This is bad because we’re wasting a lot of memory in our environment that we’ll never use again.</p>
<p>Another strategy is just to overwrite the same dataset</p>
<div class="sourceCode" id="section-cb632"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb632-1"><a href="section-dplyr-and-tidy.html#section-cb632-1"></a>VSG &lt;-<span class="st"> </span><span class="kw">select</span>(VSG, fav_sanders_<span class="dv">2019</span>, fav_warren_<span class="dv">2019</span>)</span>
<span id="section-cb632-2"><a href="section-dplyr-and-tidy.html#section-cb632-2"></a>VSG <span class="op">&lt;</span><span class="st"> </span><span class="op">-</span><span class="kw">mutate</span>(VSG, <span class="dt">fav_sanders_binary =</span> (fav_sanders_<span class="dv">2019</span><span class="op">&lt;=</span><span class="dv">2</span>)<span class="op">*</span><span class="dv">1</span>)</span>
<span id="section-cb632-3"><a href="section-dplyr-and-tidy.html#section-cb632-3"></a>VSG &lt;-<span class="st"> </span><span class="kw">mutate</span>(VSG, <span class="dt">fav_sanders_binary=</span> <span class="kw">na_if</span>(fav_sanders_<span class="dv">2019</span>, fav_sanders_<span class="dv">2019</span><span class="op">&gt;</span><span class="dv">4</span>))</span></code></pre></div>
<p>This still wastes a lot of memory because of the way memory is managed in R. It also would be terrible to debug if something goes wrong.</p>
<p>An even more difficult way would be write a function where the output of each stage are passed onto an outer layer.</p>
<p>Or we can use the pipes</p>
<div class="sourceCode" id="section-cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb633-1"><a href="section-dplyr-and-tidy.html#section-cb633-1"></a>VSG <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb633-2"><a href="section-dplyr-and-tidy.html#section-cb633-2"></a><span class="st">  </span><span class="kw">select</span>(fav_sanders_<span class="dv">2019</span>, fav_warren_<span class="dv">2019</span>) <span class="op">%&gt;%</span></span>
<span id="section-cb633-3"><a href="section-dplyr-and-tidy.html#section-cb633-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fav_sanders_binary=</span> <span class="kw">na_if</span>(fav_sanders_<span class="dv">2019</span>, fav_sanders_<span class="dv">2019</span><span class="op">&gt;</span><span class="dv">4</span>)) <span class="op">%&gt;%</span></span>
<span id="section-cb633-4"><a href="section-dplyr-and-tidy.html#section-cb633-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fav_sanders_binary =</span> (fav_sanders_<span class="dv">2019</span><span class="op">&lt;=</span><span class="dv">2</span>)<span class="op">*</span><span class="dv">1</span>) </span></code></pre></div>
<div id="section-limitations-of-pipes" class="section level3" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> Limitations of Pipes</h3>
<ul>
<li><p>Piping works by creating a new function where object manipulations are passed from one to another</p></li>
<li><p>This means that piping won’t work in cases where:</p>
<ul>
<li>The function uses the current environment such as assign, load, or get</li>
<li>Functions that use lazy evaluation such as tryCatch, try, or supressMessages</li>
</ul></li>
<li><p>Pipes are not good in all situations</p></li>
<li><p>If you do more than 4 or 5 pipes, go ahead and make in intermediate object. Otherwise debugging is a pain.</p></li>
<li><p>If you are not actually working on just one object but instead combinig multiple objects, this is just not worth it.</p></li>
<li><p>Where ther are interdepencies (e.g., complex recoding based on multiple variables)</p></li>
<li><p>The <code>magrittr</code> package comes with some other tools for using in specific situations</p></li>
<li><p>The <code>%T&gt;%</code> pipe works by calling the function to the right, but returning the function to the left</p></li>
</ul>
<div class="sourceCode" id="section-cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb634-1"><a href="section-dplyr-and-tidy.html#section-cb634-1"></a><span class="kw">library</span>(magrittr)</span>
<span id="section-cb634-2"><a href="section-dplyr-and-tidy.html#section-cb634-2"></a>VSG&lt;-<span class="kw">read_csv</span>(<span class="st">&quot;C:/Users/maria/OneDrive/WUSTL/2019-20/PDS/VOTER_Survey_Jan217_Release1-csv.csv&quot;</span>, <span class="dt">col_types=</span><span class="kw">cols</span>(<span class="dt">weight_18_24_2018=</span><span class="st">&quot;d&quot;</span>))</span>
<span id="section-cb634-3"><a href="section-dplyr-and-tidy.html#section-cb634-3"></a>VSG <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb634-4"><a href="section-dplyr-and-tidy.html#section-cb634-4"></a><span class="st">  </span><span class="kw">select</span>(fav_sanders_<span class="dv">2019</span>, fav_warren_<span class="dv">2019</span>) <span class="op">%&gt;%</span></span>
<span id="section-cb634-5"><a href="section-dplyr-and-tidy.html#section-cb634-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fav_sanders_binary=</span> <span class="kw">na_if</span>(fav_sanders_<span class="dv">2019</span>, fav_sanders_<span class="dv">2019</span><span class="op">&gt;</span><span class="dv">4</span>)) <span class="op">%&gt;%</span></span>
<span id="section-cb634-6"><a href="section-dplyr-and-tidy.html#section-cb634-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fav_sanders_binary =</span> (fav_sanders_<span class="dv">2019</span><span class="op">&lt;=</span><span class="dv">2</span>)<span class="op">*</span><span class="dv">1</span>) <span class="op">%T&gt;%</span></span>
<span id="section-cb634-7"><a href="section-dplyr-and-tidy.html#section-cb634-7"></a><span class="st">  </span><span class="kw">plot</span>()</span></code></pre></div>
<p><img src="images/unnamed-chunk-187-1.png" width="672" /></p>
<pre><code>## # A tibble: 9,548 x 3
##    fav_sanders_2019 fav_warren_2019 fav_sanders_binary
##               &lt;dbl&gt;           &lt;dbl&gt;              &lt;dbl&gt;
##  1                1               1                  1
##  2               NA              NA                 NA
##  3                2               1                  1
##  4                4               3                  0
##  5                3               4                  0
##  6                3               1                  0
##  7                3               2                  0
##  8               NA              NA                 NA
##  9               NA              NA                 NA
## 10                2               1                  1
## # ... with 9,538 more rows</code></pre>
<ul>
<li>We may also want to use specific elements from a dataframe using the <code>%$%</code> operator</li>
</ul>
<div class="sourceCode" id="section-cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb636-1"><a href="section-dplyr-and-tidy.html#section-cb636-1"></a>VSG&lt;-<span class="st"> </span>VSG <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb636-2"><a href="section-dplyr-and-tidy.html#section-cb636-2"></a><span class="st">  </span><span class="kw">select</span>(fav_sanders_<span class="dv">2019</span>, fav_warren_<span class="dv">2019</span>) <span class="op">%&gt;%</span></span>
<span id="section-cb636-3"><a href="section-dplyr-and-tidy.html#section-cb636-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fav_sanders_binary=</span> <span class="kw">na_if</span>(fav_sanders_<span class="dv">2019</span>, fav_sanders_<span class="dv">2019</span><span class="op">&gt;</span><span class="dv">4</span>)) <span class="op">%&gt;%</span></span>
<span id="section-cb636-4"><a href="section-dplyr-and-tidy.html#section-cb636-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fav_sanders_binary =</span> (fav_sanders_<span class="dv">2019</span><span class="op">&lt;=</span><span class="dv">2</span>)<span class="op">*</span><span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="section-cb636-5"><a href="section-dplyr-and-tidy.html#section-cb636-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fav_warren_binary=</span> <span class="kw">na_if</span>(fav_warren_<span class="dv">2019</span>, fav_warren_<span class="dv">2019</span><span class="op">&gt;</span><span class="dv">4</span>)) <span class="op">%&gt;%</span></span>
<span id="section-cb636-6"><a href="section-dplyr-and-tidy.html#section-cb636-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fav_warren_binary =</span> (fav_warren_<span class="dv">2019</span><span class="op">&lt;=</span><span class="dv">2</span>)<span class="op">*</span><span class="dv">1</span>)</span>
<span id="section-cb636-7"><a href="section-dplyr-and-tidy.html#section-cb636-7"></a></span>
<span id="section-cb636-8"><a href="section-dplyr-and-tidy.html#section-cb636-8"></a><span class="kw">library</span>(magrittr)</span>
<span id="section-cb636-9"><a href="section-dplyr-and-tidy.html#section-cb636-9"></a>VSG&lt;-<span class="st"> </span>VSG <span class="op">%$%</span><span class="st"> </span></span>
<span id="section-cb636-10"><a href="section-dplyr-and-tidy.html#section-cb636-10"></a><span class="st">  </span><span class="kw">plot</span>(<span class="kw">table</span>(fav_sanders_binary, fav_warren_binary))</span></code></pre></div>
<p><img src="images/unnamed-chunk-188-1.png" width="672" /></p>
</div>
</div>
<div id="section-map" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> <code>map</code></h2>
<div class="sourceCode" id="section-cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb637-1"><a href="section-dplyr-and-tidy.html#section-cb637-1"></a>VSG&lt;-<span class="kw">read_csv</span>(<span class="st">&quot;C:/Users/maria/OneDrive/WUSTL/2019-20/PDS/VOTER_Survey_Jan217_Release1-csv.csv&quot;</span>, <span class="dt">col_types=</span><span class="kw">cols</span>(<span class="dt">weight_18_24_2018=</span><span class="st">&quot;d&quot;</span>))</span>
<span id="section-cb637-2"><a href="section-dplyr-and-tidy.html#section-cb637-2"></a>VSG.fav&lt;-VSG <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="section-cb637-3"><a href="section-dplyr-and-tidy.html#section-cb637-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;fav&quot;</span>)) </span></code></pre></div>
<p>We want to loop over these data and recode all of the columns according to our rules</p>
<ul>
<li>Anything above a 4 gets moved to NA</li>
<li>Then we turn them into a binary based on whether they are 2 and less or not</li>
</ul>
<div class="sourceCode" id="section-cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb638-1"><a href="section-dplyr-and-tidy.html#section-cb638-1"></a>output&lt;-<span class="kw">as.data.frame</span>(<span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="kw">nrow</span>(VSG.fav), <span class="kw">ncol</span>(VSG.fav)))</span>
<span id="section-cb638-2"><a href="section-dplyr-and-tidy.html#section-cb638-2"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(VSG.fav)){</span>
<span id="section-cb638-3"><a href="section-dplyr-and-tidy.html#section-cb638-3"></a>  output[,i]&lt;-(VSG.fav[,i]<span class="op">&lt;=</span><span class="dv">2</span>)<span class="op">*</span><span class="dv">1</span></span>
<span id="section-cb638-4"><a href="section-dplyr-and-tidy.html#section-cb638-4"></a>}</span></code></pre></div>
<ul>
<li>We could do this without making a new object</li>
</ul>
<div class="sourceCode" id="section-cb639"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb639-1"><a href="section-dplyr-and-tidy.html#section-cb639-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(VSG.fav)){</span>
<span id="section-cb639-2"><a href="section-dplyr-and-tidy.html#section-cb639-2"></a>  VSG.fav[,i]=<span class="st"> </span><span class="kw">na_if</span>(VSG.fav[[i]],VSG.fav[[i]]<span class="op">&gt;</span><span class="dv">4</span>)</span>
<span id="section-cb639-3"><a href="section-dplyr-and-tidy.html#section-cb639-3"></a>  VSG.fav[,i]&lt;-(VSG.fav[,i]<span class="op">&lt;=</span><span class="dv">2</span>)<span class="op">*</span><span class="dv">1</span></span>
<span id="section-cb639-4"><a href="section-dplyr-and-tidy.html#section-cb639-4"></a>}</span>
<span id="section-cb639-5"><a href="section-dplyr-and-tidy.html#section-cb639-5"></a><span class="kw">head</span>(VSG.fav)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 68
##   fav_trump_2019 fav_obama_2019 fav_hrc_2019 fav_sanders_2019 fav_putin_2019
##            &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;
## 1              0              1            1                1              0
## 2             NA             NA           NA               NA             NA
## 3              0              1            1                1              0
## 4              0              1            0                0              0
## 5              1              1            0                0              0
## 6              0              1            1                0              0
## # ... with 63 more variables: fav_schumer_2019 &lt;dbl&gt;, fav_pelosi_2019 &lt;dbl&gt;,
## #   fav_comey_2019 &lt;dbl&gt;, fav_mueller_2019 &lt;dbl&gt;, fav_mcconnell_2019 &lt;dbl&gt;,
## #   fav_kavanaugh_2019 &lt;dbl&gt;, fav_biden_2019 &lt;dbl&gt;, fav_warren_2019 &lt;dbl&gt;,
## #   fav_harris_2019 &lt;dbl&gt;, fav_gillibrand_2019 &lt;dbl&gt;, fav_patrick_2019 &lt;dbl&gt;,
## #   fav_booker_2019 &lt;dbl&gt;, fav_garcetti_2019 &lt;dbl&gt;, fav_klobuchar_2019 &lt;dbl&gt;,
## #   fav_gorsuch_2019 &lt;dbl&gt;, fav_kasich_2019 &lt;dbl&gt;, fav_haley_2019 &lt;dbl&gt;,
## #   fav_bloomberg_2019 &lt;dbl&gt;, fav_holder_2019 &lt;dbl&gt;, fav_avenatti_2019 &lt;dbl&gt;,
## #   fav_castro_2019 &lt;dbl&gt;, fav_landrieu_2019 &lt;dbl&gt;, fav_orourke_2019 &lt;dbl&gt;,
## #   fav_hickenlooper_2019 &lt;dbl&gt;, fav_pence_2019 &lt;dbl&gt;, favorhealth_2019 &lt;dbl&gt;,
## #   fav_trump_2018 &lt;dbl&gt;, fav_ryan_2018 &lt;dbl&gt;, fav_obama_2018 &lt;dbl&gt;,
## #   fav_hrc_2018 &lt;dbl&gt;, fav_sanders_2018 &lt;dbl&gt;, fav_putin_2018 &lt;dbl&gt;,
## #   fav_schumer_2018 &lt;dbl&gt;, fav_pelosi_2018 &lt;dbl&gt;, fav_comey_2018 &lt;dbl&gt;,
## #   fav_mueller_2018 &lt;dbl&gt;, fav_mcconnell_2018 &lt;dbl&gt;, fav_trump_2017 &lt;dbl&gt;,
## #   fav_ryan_2017 &lt;dbl&gt;, fav_obama_2017 &lt;dbl&gt;, fav_hrc_2017 &lt;dbl&gt;,
## #   fav_sanders_2017 &lt;dbl&gt;, fav_putin_2017 &lt;dbl&gt;, fav_trump_2016 &lt;dbl&gt;,
## #   fav_cruz_2016 &lt;dbl&gt;, fav_ryan_2016 &lt;dbl&gt;, fav_romn_2016 &lt;dbl&gt;,
## #   fav_obama_2016 &lt;dbl&gt;, fav_hrc_2016 &lt;dbl&gt;, fav_sanders_2016 &lt;dbl&gt;,
## #   fav_rubio_2016 &lt;dbl&gt;, fav_grid_row_rnd_2016 &lt;dbl&gt;,
## #   fav_grid_col_rnd_2016 &lt;dbl&gt;, fav_romn_baseline &lt;dbl&gt;,
## #   fav_ging_baseline &lt;dbl&gt;, fav_hunt_baseline &lt;dbl&gt;, fav_bach_baseline &lt;dbl&gt;,
## #   fav_ronp_baseline &lt;dbl&gt;, fav_sant_baseline &lt;dbl&gt;, fav_perr_baseline &lt;dbl&gt;,
## #   fav_obama_baseline &lt;dbl&gt;, fav_hrc_baseline &lt;dbl&gt;, fav_biden_baseline &lt;dbl&gt;</code></pre>
<ul>
<li><p>We can also loop where we aren’t sure how long the final output is</p></li>
<li><p>This can be done by adding each element to the end of a vector as we did in some previous lectures</p></li>
<li><p>This is computationally expensive</p></li>
<li><p>A better solution is to add all of them to a list and then combine them back at the end.</p></li>
<li><p>See Chapter 23.3.3 in the book for more</p></li>
<li><p>Or Chapter 23.3.4 for while loops (which we have already covered)</p></li>
<li><p>Looping is such a pervasive task, that there are functions to make it easier</p></li>
<li><p>The <code>map</code> family will do this, and you can carefully control the output</p>
<ul>
<li><code>map</code> makes a list</li>
<li><code>map_lgl</code> makes a logical vector</li>
<li><code>map_int</code> makes an integer</li>
<li><code>map_dbl</code> makes a double vector</li>
<li><code>map_chr</code> makes a character</li>
</ul></li>
<li><p>These functions takes in a vector as an input and applies that function</p></li>
<li><p>Let’s say that we want to find the mean level of favorability in our dataset</p></li>
<li><p>This is <em>very</em> similar to <code>lapply</code> in base R</p>
<ul>
<li>For a comparison, check <a href="https://jennybc.github.io/purrr-tutorial/bk01_base-functions.html#lapply()_vs_purrr::map()">this</a> link out</li>
</ul></li>
</ul>
<div class="sourceCode" id="section-cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb641-1"><a href="section-dplyr-and-tidy.html#section-cb641-1"></a><span class="kw">map</span>(VSG.fav, mean, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## $fav_trump_2019
## [1] 0.4214486
## 
## $fav_obama_2019
## [1] 0.5311993
## 
## $fav_hrc_2019
## [1] 0.3907656
## 
## $fav_sanders_2019
## [1] 0.4724886
## 
## $fav_putin_2019
## [1] 0.08172297
## 
## $fav_schumer_2019
## [1] 0.3249742
## 
## $fav_pelosi_2019
## [1] 0.3808821
## 
## $fav_comey_2019
## [1] 0.2996017
## 
## $fav_mueller_2019
## [1] 0.4549344
## 
## $fav_mcconnell_2019
## [1] 0.2793922
## 
## $fav_kavanaugh_2019
## [1] 0.4047795
## 
## $fav_biden_2019
## [1] 0.5340021
## 
## $fav_warren_2019
## [1] 0.4173182
## 
## $fav_harris_2019
## [1] 0.322909
## 
## $fav_gillibrand_2019
## [1] 0.2838177
## 
## $fav_patrick_2019
## [1] 0.1606432
## 
## $fav_booker_2019
## [1] 0.3462163
## 
## $fav_garcetti_2019
## [1] 0.1048827
## 
## $fav_klobuchar_2019
## [1] 0.2283523
## 
## $fav_gorsuch_2019
## [1] 0.354182
## 
## $fav_kasich_2019
## [1] 0.3192211
## 
## $fav_haley_2019
## [1] 0.420416
## 
## $fav_bloomberg_2019
## [1] 0.3218764
## 
## $fav_holder_2019
## [1] 0.3221714
## 
## $fav_avenatti_2019
## [1] 0.1737719
## 
## $fav_castro_2019
## [1] 0.2015046
## 
## $fav_landrieu_2019
## [1] 0.1274524
## 
## $fav_orourke_2019
## [1] 0.364213
## 
## $fav_hickenlooper_2019
## [1] 0.1295176
## 
## $fav_pence_2019
## [1] 0.4437233
## 
## $favorhealth_2019
## [1] 0.476914
## 
## $fav_trump_2018
## [1] 0.3953372
## 
## $fav_ryan_2018
## [1] 0.2812656
## 
## $fav_obama_2018
## [1] 0.5322231
## 
## $fav_hrc_2018
## [1] 0.3900083
## 
## $fav_sanders_2018
## [1] 0.4814321
## 
## $fav_putin_2018
## [1] 0.07693589
## 
## $fav_schumer_2018
## [1] 0.3080766
## 
## $fav_pelosi_2018
## [1] 0.3233972
## 
## $fav_comey_2018
## [1] 0.3172356
## 
## $fav_mueller_2018
## [1] 0.4066611
## 
## $fav_mcconnell_2018
## [1] 0.1567027
## 
## $fav_trump_2017
## [1] 0.43642
## 
## $fav_ryan_2017
## [1] 0.2748614
## 
## $fav_obama_2017
## [1] 0.4928269
## 
## $fav_hrc_2017
## [1] 0.4029997
## 
## $fav_sanders_2017
## [1] 0.4768503
## 
## $fav_putin_2017
## [1] 0.1092273
## 
## $fav_trump_2016
## [1] 0.4416231
## 
## $fav_cruz_2016
## [1] 0.3446602
## 
## $fav_ryan_2016
## [1] 0.3635798
## 
## $fav_romn_2016
## [1] 0.3480209
## 
## $fav_obama_2016
## [1] 0.4887976
## 
## $fav_hrc_2016
## [1] 0.418347
## 
## $fav_sanders_2016
## [1] 0.5373413
## 
## $fav_rubio_2016
## [1] 0.4218322
## 
## $fav_grid_row_rnd_2016
## [1] 0
## 
## $fav_grid_col_rnd_2016
## [1] 0
## 
## $fav_romn_baseline
## [1] 0.4337814
## 
## $fav_ging_baseline
## [1] 0.3297237
## 
## $fav_hunt_baseline
## [1] 0.3512572
## 
## $fav_bach_baseline
## [1] 0.3188947
## 
## $fav_ronp_baseline
## [1] 0.3409261
## 
## $fav_sant_baseline
## [1] 0.377645
## 
## $fav_perr_baseline
## [1] 0.3066965
## 
## $fav_obama_baseline
## [1] 0.4814538
## 
## $fav_hrc_baseline
## [1] 0.5892457
## 
## $fav_biden_baseline
## [1] 0.4600448</code></pre>
<div class="sourceCode" id="section-cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb643-1"><a href="section-dplyr-and-tidy.html#section-cb643-1"></a><span class="kw">map_dbl</span>(VSG.fav, mean, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##        fav_trump_2019        fav_obama_2019          fav_hrc_2019 
##            0.42144859            0.53119929            0.39076560 
##      fav_sanders_2019        fav_putin_2019      fav_schumer_2019 
##            0.47248857            0.08172297            0.32497418 
##       fav_pelosi_2019        fav_comey_2019      fav_mueller_2019 
##            0.38088214            0.29960171            0.45493436 
##    fav_mcconnell_2019    fav_kavanaugh_2019        fav_biden_2019 
##            0.27939224            0.40477947            0.53400207 
##       fav_warren_2019       fav_harris_2019   fav_gillibrand_2019 
##            0.41731819            0.32290898            0.28381767 
##      fav_patrick_2019       fav_booker_2019     fav_garcetti_2019 
##            0.16064316            0.34621626            0.10488273 
##    fav_klobuchar_2019      fav_gorsuch_2019       fav_kasich_2019 
##            0.22835226            0.35418203            0.31922112 
##        fav_haley_2019    fav_bloomberg_2019       fav_holder_2019 
##            0.42041599            0.32187638            0.32217141 
##     fav_avenatti_2019       fav_castro_2019     fav_landrieu_2019 
##            0.17377194            0.20150465            0.12745243 
##      fav_orourke_2019 fav_hickenlooper_2019        fav_pence_2019 
##            0.36421301            0.12951763            0.44372326 
##      favorhealth_2019        fav_trump_2018         fav_ryan_2018 
##            0.47691400            0.39533722            0.28126561 
##        fav_obama_2018          fav_hrc_2018      fav_sanders_2018 
##            0.53222315            0.39000833            0.48143214 
##        fav_putin_2018      fav_schumer_2018       fav_pelosi_2018 
##            0.07693589            0.30807660            0.32339717 
##        fav_comey_2018      fav_mueller_2018    fav_mcconnell_2018 
##            0.31723564            0.40666112            0.15670275 
##        fav_trump_2017         fav_ryan_2017        fav_obama_2017 
##            0.43641995            0.27486143            0.49282687 
##          fav_hrc_2017      fav_sanders_2017        fav_putin_2017 
##            0.40299967            0.47685034            0.10922726 
##        fav_trump_2016         fav_cruz_2016         fav_ryan_2016 
##            0.44162310            0.34466019            0.36357979 
##         fav_romn_2016        fav_obama_2016          fav_hrc_2016 
##            0.34802091            0.48879761            0.41834703 
##      fav_sanders_2016        fav_rubio_2016 fav_grid_row_rnd_2016 
##            0.53734130            0.42183221            0.00000000 
## fav_grid_col_rnd_2016     fav_romn_baseline     fav_ging_baseline 
##            0.00000000            0.43378143            0.32972367 
##     fav_hunt_baseline     fav_bach_baseline     fav_ronp_baseline 
##            0.35125716            0.31889470            0.34092606 
##     fav_sant_baseline     fav_perr_baseline    fav_obama_baseline 
##            0.37764501            0.30669654            0.48145382 
##      fav_hrc_baseline    fav_biden_baseline 
##            0.58924571            0.46004481</code></pre>
<div class="sourceCode" id="section-cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="section-cb645-1"><a href="section-dplyr-and-tidy.html#section-cb645-1"></a><span class="kw">map_chr</span>(VSG.fav, mean, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##        fav_trump_2019        fav_obama_2019          fav_hrc_2019 
##            &quot;0.421449&quot;            &quot;0.531199&quot;            &quot;0.390766&quot; 
##      fav_sanders_2019        fav_putin_2019      fav_schumer_2019 
##            &quot;0.472489&quot;            &quot;0.081723&quot;            &quot;0.324974&quot; 
##       fav_pelosi_2019        fav_comey_2019      fav_mueller_2019 
##            &quot;0.380882&quot;            &quot;0.299602&quot;            &quot;0.454934&quot; 
##    fav_mcconnell_2019    fav_kavanaugh_2019        fav_biden_2019 
##            &quot;0.279392&quot;            &quot;0.404779&quot;            &quot;0.534002&quot; 
##       fav_warren_2019       fav_harris_2019   fav_gillibrand_2019 
##            &quot;0.417318&quot;            &quot;0.322909&quot;            &quot;0.283818&quot; 
##      fav_patrick_2019       fav_booker_2019     fav_garcetti_2019 
##            &quot;0.160643&quot;            &quot;0.346216&quot;            &quot;0.104883&quot; 
##    fav_klobuchar_2019      fav_gorsuch_2019       fav_kasich_2019 
##            &quot;0.228352&quot;            &quot;0.354182&quot;            &quot;0.319221&quot; 
##        fav_haley_2019    fav_bloomberg_2019       fav_holder_2019 
##            &quot;0.420416&quot;            &quot;0.321876&quot;            &quot;0.322171&quot; 
##     fav_avenatti_2019       fav_castro_2019     fav_landrieu_2019 
##            &quot;0.173772&quot;            &quot;0.201505&quot;            &quot;0.127452&quot; 
##      fav_orourke_2019 fav_hickenlooper_2019        fav_pence_2019 
##            &quot;0.364213&quot;            &quot;0.129518&quot;            &quot;0.443723&quot; 
##      favorhealth_2019        fav_trump_2018         fav_ryan_2018 
##            &quot;0.476914&quot;            &quot;0.395337&quot;            &quot;0.281266&quot; 
##        fav_obama_2018          fav_hrc_2018      fav_sanders_2018 
##            &quot;0.532223&quot;            &quot;0.390008&quot;            &quot;0.481432&quot; 
##        fav_putin_2018      fav_schumer_2018       fav_pelosi_2018 
##            &quot;0.076936&quot;            &quot;0.308077&quot;            &quot;0.323397&quot; 
##        fav_comey_2018      fav_mueller_2018    fav_mcconnell_2018 
##            &quot;0.317236&quot;            &quot;0.406661&quot;            &quot;0.156703&quot; 
##        fav_trump_2017         fav_ryan_2017        fav_obama_2017 
##            &quot;0.436420&quot;            &quot;0.274861&quot;            &quot;0.492827&quot; 
##          fav_hrc_2017      fav_sanders_2017        fav_putin_2017 
##            &quot;0.403000&quot;            &quot;0.476850&quot;            &quot;0.109227&quot; 
##        fav_trump_2016         fav_cruz_2016         fav_ryan_2016 
##            &quot;0.441623&quot;            &quot;0.344660&quot;            &quot;0.363580&quot; 
##         fav_romn_2016        fav_obama_2016          fav_hrc_2016 
##            &quot;0.348021&quot;            &quot;0.488798&quot;            &quot;0.418347&quot; 
##      fav_sanders_2016        fav_rubio_2016 fav_grid_row_rnd_2016 
##            &quot;0.537341&quot;            &quot;0.421832&quot;            &quot;0.000000&quot; 
## fav_grid_col_rnd_2016     fav_romn_baseline     fav_ging_baseline 
##            &quot;0.000000&quot;            &quot;0.433781&quot;            &quot;0.329724&quot; 
##     fav_hunt_baseline     fav_bach_baseline     fav_ronp_baseline 
##            &quot;0.351257&quot;            &quot;0.318895&quot;            &quot;0.340926&quot; 
##     fav_sant_baseline     fav_perr_baseline    fav_obama_baseline 
##            &quot;0.377645&quot;            &quot;0.306697&quot;            &quot;0.481454&quot; 
##      fav_hrc_baseline    fav_biden_baseline 
##            &quot;0.589246&quot;            &quot;0.460045&quot;</code></pre>
</div>
<div id="section-walk-purrr-and-more" class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> walk, purrr, and more</h2>
<ul>
<li>See Chapter 21.8 for a discussion of <code>walk</code></li>
<li>Main idea here is when you want to use a function for its side operations (e.g., plot) rather than to manipulate the data</li>
<li>See also Chapter 21.9.1 for some additional functionality that is occasionally useful:
<ul>
<li><code>keep</code></li>
<li><code>discard</code></li>
<li><code>some</code></li>
<li><code>every</code></li>
</ul></li>
<li>See Chapter 21.9.2 for even more advanced approaches to extracting data</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-data-visualization-in-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-more-useful-packages.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
